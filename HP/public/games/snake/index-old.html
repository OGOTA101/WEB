<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ ã‚¹ãƒãƒ¼ã‚¯ã‚²ãƒ¼ãƒ  - SGGameSite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #f6f6f6;
            color: #000;
            font-size: 14px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            border-left: 1px solid #ccc;
            border-right: 1px solid #ccc;
        }

        .header {
            background: #316AC5;
            color: white;
            padding: 8px 0;
            border-bottom: 2px solid #0066cc;
        }

        .header-content {
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
        }

        .header .tagline {
            font-size: 11px;
            color: #cce0ff;
        }

        .breadcrumb {
            background: #e6f0ff;
            padding: 8px 15px;
            border-bottom: 1px solid #ccc;
            font-size: 13px;
        }

        .breadcrumb a {
            color: #0066cc;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .game-container {
            padding: 20px;
            text-align: center;
        }

        .game-title {
            font-size: 24px;
            color: #316AC5;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .game-info {
            background: #ffffcc;
            border: 1px solid #ffcc00;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .game-info h3 {
            color: #cc6600;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .controls-info {
            background: #f0f0f0;
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .controls-info h4 {
            color: #316AC5;
            margin-bottom: 10px;
        }

        .game-board {
            display: inline-block;
            background: #000;
            border: 3px solid #316AC5;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            touch-action: none;
            position: relative;
        }

        /* ã‚²ãƒ¼ãƒ é–‹å§‹ç”»é¢ */
        .start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .start-content {
            text-align: center;
            color: white;
        }

        .game-title {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px #316AC5;
            background: linear-gradient(45deg, #316AC5, #4a90e2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-subtitle {
            font-size: 1.2em;
            margin-bottom: 30px;
            color: #cccccc;
        }

        .btn-large {
            padding: 15px 30px;
            font-size: 1.3em;
            margin: 10px;
        }

        .btn-secondary {
            background: #666;
        }

        .btn-secondary:hover {
            background: #888;
        }

        /* ä¸€æ™‚åœæ­¢ãƒ»å†ç”Ÿãƒœã‚¿ãƒ³ */
        .pause-play-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #316AC5;
            color: white;
            font-size: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 5;
            transition: all 0.3s;
        }

        .pause-play-btn:hover {
            background: rgba(49, 106, 197, 0.2);
            transform: scale(1.1);
        }

        /* ãƒ€ã‚¤ã‚¢ãƒ­ã‚° */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .dialog {
            background: white;
            border: 2px solid #316AC5;
            border-radius: 15px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(49, 106, 197, 0.5);
        }

        .dialog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #ccc;
            background: #f0f8ff;
        }

        .dialog-header h3 {
            margin: 0;
            color: #316AC5;
        }

        .close-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .dialog-content {
            padding: 20px;
            color: #333;
            line-height: 1.6;
        }

        .dialog-content h4 {
            color: #316AC5;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .dialog-content h4:first-child {
            margin-top: 0;
        }

        .dialog-content p {
            margin-bottom: 10px;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: #e6f0ff;
            border: 1px solid #ccc;
            padding: 10px 20px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #316AC5;
        }

        .game-buttons {
            margin-bottom: 20px;
        }

        .btn {
            background: #316AC5;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #4a90e2;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .game-over {
            background: #ffeeee;
            border: 2px solid #ff0000;
            padding: 20px;
            margin: 20px auto;
            border-radius: 10px;
            max-width: 400px;
            display: none;
        }

        .game-over h3 {
            color: #ff0000;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .high-score {
            background: #eeffee;
            border: 2px solid #00aa00;
            padding: 15px;
            margin: 20px auto;
            border-radius: 10px;
            max-width: 400px;
        }

        .high-score h4 {
            color: #00aa00;
            margin-bottom: 10px;
        }

        .back-link {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
        }

        .back-link a {
            color: #0066cc;
            text-decoration: none;
            font-size: 14px;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        .mobile-controls {
            display: none;
            margin-top: 20px;
            gap: 10px;
            justify-content: center;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            max-width: 200px;
            margin-left: auto;
            margin-right: auto;
        }

        .mobile-btn {
            background: #316AC5;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            min-width: 50px;
            min-height: 50px;
            touch-action: manipulation;
        }

        .mobile-btn:active {
            background: #4a90e2;
        }

        .food-legend {
            background: #f0f8ff;
            border: 1px solid #4a90e2;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .food-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .food-icon {
            font-size: 20px;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }

            .game-stats {
                gap: 15px;
            }

            .mobile-controls {
                display: grid;
            }

            .game-board {
                max-width: 100%;
                border-width: 2px;
            }

            #gameCanvas {
                max-width: 100%;
                height: auto;
            }

            .food-legend {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .game-stats {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                margin: 5px;
                padding: 10px 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <div class="header-content">
                <h1>ğŸ® SGGameSite</h1>
                <div class="tagline">Yahoo! Gamesé¢¨ãƒ¬ãƒˆãƒ­ã‚²ãƒ¼ãƒ ã‚µã‚¤ãƒˆ</div>
            </div>
        </div>

        <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ -->
        <div class="breadcrumb">
            <a href="../../index.html">ãƒ›ãƒ¼ãƒ </a> > <a href="../../index.html#games">ã‚²ãƒ¼ãƒ </a> > ã‚¹ãƒãƒ¼ã‚¯ã‚²ãƒ¼ãƒ 
        </div>

        <!-- ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="game-container">
            <div class="game-title">ğŸ ã‚¹ãƒãƒ¼ã‚¯ã‚²ãƒ¼ãƒ  Enhanced</div>

            <div class="game-info">
                <h3>ğŸ¯ ã‚²ãƒ¼ãƒ ã®éŠã³æ–¹</h3>
                <p>è›‡ã‚’æ“ä½œã—ã¦æ§˜ã€…ãªé£Ÿã¹ç‰©ã‚’é£Ÿã¹ã€ã§ãã‚‹ã ã‘é•·ãæˆé•·ã•ã›ã‚ˆã†ï¼</p>
                <p>å£ã‚„è‡ªåˆ†ã®ä½“ã«ã¶ã¤ã‹ã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã™ã€‚</p>
            </div>

            <!-- é£Ÿã¹ç‰©ã®èª¬æ˜ -->
            <div class="food-legend">
                <div class="food-item">
                    <span class="food-icon">ğŸ</span>
                    <span>ã‚Šã‚“ã” (+10ç‚¹)</span>
                </div>
                <div class="food-item">
                    <span class="food-icon">ğŸŒ</span>
                    <span>ãƒãƒŠãƒŠ (+15ç‚¹)</span>
                </div>
                <div class="food-item">
                    <span class="food-icon">ğŸ‡</span>
                    <span>ã¶ã©ã† (+20ç‚¹)</span>
                </div>
                <div class="food-item">
                    <span class="food-icon">ğŸ“</span>
                    <span>ã„ã¡ã” (+25ç‚¹)</span>
                </div>
                <div class="food-item">
                    <span class="food-icon">ğŸ¥‡</span>
                    <span>ç‰¹åˆ¥è³ (+100ç‚¹, 4ãƒã‚¹åˆ†)</span>
                </div>
            </div>

            <div class="controls-info">
                <h4>ğŸ•¹ï¸ æ“ä½œæ–¹æ³•</h4>
                <p><strong>PC:</strong> çŸ¢å°ã‚­ãƒ¼ï¼ˆâ†‘â†“â†â†’ï¼‰ã¾ãŸã¯WASD</p>
                <p><strong>ã‚¹ãƒãƒ›:</strong> ç”»é¢ã‚¹ãƒ¯ã‚¤ãƒ—ã¾ãŸã¯æ–¹å‘ãƒœã‚¿ãƒ³</p>
            </div>

            <!-- ã‚²ãƒ¼ãƒ çµ±è¨ˆ -->
            <div class="game-stats">
                <div class="stat-item">
                    <div class="stat-label">ã‚¹ã‚³ã‚¢</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">é•·ã•</div>
                    <div class="stat-value" id="length">1</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æœ€é«˜ã‚¹ã‚³ã‚¢</div>
                    <div class="stat-value" id="highScore">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ç‰¹åˆ¥è³</div>
                    <div class="stat-value" id="bonusCount">0</div>
                </div>
            </div>

            <!-- ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
            <div class="game-buttons">
                <button class="btn" id="startBtn" onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
                <button class="btn" id="pauseBtn" onclick="pauseGame()" disabled>ä¸€æ™‚åœæ­¢</button>
                <button class="btn" id="resetBtn" onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>

            <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
            <div class="game-board">
                <canvas id="gameCanvas" width="600" height="600"></canvas>

                <!-- ã‚²ãƒ¼ãƒ é–‹å§‹ç”»é¢ -->
                <div id="startScreen" class="start-screen">
                    <div class="start-content">
                        <h1 class="game-title">ğŸ SNAKE GAME</h1>
                        <p class="game-subtitle">ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’é£Ÿã¹ã¦å¤§ãããªã‚ã†ï¼</p>
                        <button id="startGameBtn" class="btn btn-large">ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹</button>
                        <button id="howToPlayBtn" class="btn btn-secondary">ğŸ“– éŠã³æ–¹</button>
                    </div>
                </div>

                <!-- ä¸€æ™‚åœæ­¢ãƒ»å†ç”Ÿãƒœã‚¿ãƒ³ -->
                <button id="pausePlayBtn" class="pause-play-btn" style="display: none;">â¸ï¸</button>
            </div>

            <!-- éŠã³æ–¹ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
            <div id="howToPlayDialog" class="dialog-overlay">
                <div class="dialog">
                    <div class="dialog-header">
                        <h3>ğŸ“– éŠã³æ–¹</h3>
                        <button id="closeDialog" class="close-btn">Ã—</button>
                    </div>
                    <div class="dialog-content">
                        <h4>ğŸ¯ ã‚²ãƒ¼ãƒ ã®ç›®çš„</h4>
                        <p>è›‡ã‚’æ“ç¸¦ã—ã¦ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’é£Ÿã¹ã€ã§ãã‚‹ã ã‘é•·ãæˆé•·ã•ã›ã‚ˆã†ï¼</p>

                        <h4>ğŸ•¹ï¸ æ“ä½œæ–¹æ³•</h4>
                        <p><strong>PC:</strong> çŸ¢å°ã‚­ãƒ¼ï¼ˆâ†‘â†“â†â†’ï¼‰ã§è›‡ã‚’æ“ç¸¦</p>
                        <p><strong>ã‚¹ãƒãƒ›:</strong> ç”»é¢ã‚’ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦æ–¹å‘è»¢æ›</p>
                        <p><strong>ãƒœã‚¿ãƒ³:</strong> ç”»é¢ä¸‹ã®çŸ¢å°ãƒœã‚¿ãƒ³ã§ã‚‚æ“ä½œå¯èƒ½</p>

                        <h4>ğŸ ãƒ•ãƒ«ãƒ¼ãƒ„ã®ç¨®é¡</h4>
                        <p>â€¢ ğŸ ã‚Šã‚“ã”: 10ç‚¹</p>
                        <p>â€¢ ğŸŒ ãƒãƒŠãƒŠ: 15ç‚¹</p>
                        <p>â€¢ ğŸ‡ ã¶ã©ã†: 20ç‚¹</p>
                        <p>â€¢ ğŸ“ ã„ã¡ã”: 25ç‚¹</p>
                        <p>â€¢ ğŸ¥‡ ç‰¹åˆ¥è³: 100ç‚¹ï¼ˆã¾ã‚Œã«å‡ºç¾ï¼‰</p>

                        <h4>âš ï¸ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ¡ä»¶</h4>
                        <p>â€¢ å£ã«ã¶ã¤ã‹ã‚‹</p>
                        <p>â€¢ è‡ªåˆ†ã®ä½“ã«ã¶ã¤ã‹ã‚‹</p>
                    </div>
                </div>
            </div>

            <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="mobile-controls">
                <div style="grid-column: 2;">
                    <button class="mobile-btn" onclick="changeDirection('UP')">â†‘</button>
                </div>
                <div style="grid-row: 2;">
                    <button class="mobile-btn" onclick="changeDirection('LEFT')">â†</button>
                </div>
                <div style="grid-row: 2; grid-column: 2;">
                    <button class="mobile-btn" onclick="changeDirection('DOWN')">â†“</button>
                </div>
                <div style="grid-row: 2; grid-column: 3;">
                    <button class="mobile-btn" onclick="changeDirection('RIGHT')">â†’</button>
                </div>
            </div>

            <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼è¡¨ç¤º -->
            <div class="game-over" id="gameOver">
                <h3>ğŸš« ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼</h3>
                <p>æœ€çµ‚ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span></p>
                <p>è›‡ã®é•·ã•: <span id="finalLength">1</span></p>
                <p>ç‰¹åˆ¥è³ç²å¾—: <span id="finalBonus">0</span>å€‹</p>
                <button class="btn" onclick="resetGame()" style="margin-top: 15px;">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
            </div>

            <!-- ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
            <div class="high-score">
                <h4>ğŸ† ä»Šå›ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ€é«˜è¨˜éŒ²</h4>
                <p>ã‚¹ã‚³ã‚¢: <span id="sessionHigh">0</span> | é•·ã•: <span id="sessionLength">1</span> | ç‰¹åˆ¥è³: <span
                        id="sessionBonus">0</span>å€‹</p>
            </div>

            <!-- æˆ»ã‚‹ãƒªãƒ³ã‚¯ -->
            <div class="back-link">
                <a href="../../index.html">â† ã‚²ãƒ¼ãƒ ä¸€è¦§ã«æˆ»ã‚‹</a>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ å¤‰æ•°
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 20;
        const canvasSize = 600;

        let snake = [{ x: 300, y: 300 }];
        let direction = { x: 0, y: 0 };
        let foods = [];
        let score = 0;
        let bonusCount = 0;
        let gameRunning = false;
        let gameLoop = null;
        let isPaused = false;

        // ã‚¿ãƒƒãƒ/ã‚¹ãƒ¯ã‚¤ãƒ—é–¢é€£å¤‰æ•°
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;

        // ç”»åƒãƒªã‚½ãƒ¼ã‚¹
        const fruitImages = {};
        let imagesLoaded = 0;
        const totalImages = 5;

        // é£Ÿã¹ç‰©ã®ç¨®é¡
        const foodTypes = [
            { emoji: 'ğŸ', points: 10, color: '#ff0000', weight: 40, image: 'apple' },
            { emoji: 'ğŸŒ', points: 15, color: '#ffff00', weight: 30, image: 'banana' },
            { emoji: 'ğŸ‡', points: 20, color: '#800080', weight: 20, image: 'grape' },
            { emoji: 'ğŸ“', points: 25, color: '#ff69b4', weight: 10, image: 'strawberry' }
        ];

        const specialFood = { emoji: 'ğŸ¥‡', points: 100, color: '#ffd700', size: 2, image: 'special' };

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’èª­ã¿è¾¼ã¿
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let sessionHighScore = 0;
        let sessionHighLength = 1;
        let sessionHighBonus = 0;

        // ç”»åƒèª­ã¿è¾¼ã¿
        function loadImages() {
            const imageNames = ['apple', 'banana', 'grape', 'strawberry', 'special'];

            imageNames.forEach(name => {
                const img = new Image();
                img.onload = () => {
                    imagesLoaded++;
                    if (imagesLoaded === totalImages) {
                        // å…¨ã¦ã®ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰åˆæœŸåŒ–å®Œäº†
                        document.getElementById('startGameBtn').disabled = false;
                        document.getElementById('startGameBtn').textContent = 'ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹';
                    }
                };
                img.onerror = () => {
                    console.warn(`Failed to load image: ${name}.svg`);
                    imagesLoaded++;
                    if (imagesLoaded === totalImages) {
                        document.getElementById('startGameBtn').disabled = false;
                        document.getElementById('startGameBtn').textContent = 'ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹';
                    }
                };
                img.src = `assets/images/${name}.svg`;
                fruitImages[name] = img;
            });
        }

        // åˆæœŸåŒ–
        function init() {
            document.getElementById('highScore').textContent = highScore;

            // æ–°ã—ã„UIè¦ç´ ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            document.getElementById('startGameBtn').addEventListener('click', startGame);
            document.getElementById('howToPlayBtn').addEventListener('click', showHowToPlay);
            document.getElementById('pausePlayBtn').addEventListener('click', togglePause);
            document.getElementById('closeDialog').addEventListener('click', hideHowToPlay);
            document.getElementById('howToPlayDialog').addEventListener('click', function (e) {
                if (e.target === this) hideHowToPlay();
            });

            // å¤ã„ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
            document.querySelector('.game-buttons').style.display = 'none';

            // åˆæœŸçŠ¶æ…‹è¨­å®š
            document.getElementById('startGameBtn').disabled = true;
            document.getElementById('startGameBtn').textContent = 'ç”»åƒèª­ã¿è¾¼ã¿ä¸­...';

            // ç”»åƒã‚’èª­ã¿è¾¼ã¿
            loadImages();

            generateFood();
            drawGame();

            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ä»˜ãï¼‰
            document.addEventListener('keydown', handleKeyPress);

            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚¹ãƒ¯ã‚¤ãƒ—å¯¾å¿œï¼‰
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchend', handleTouchEnd, { passive: false });

            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã«èª¿æ•´
            adjustCanvasSize();
            window.addEventListener('resize', adjustCanvasSize);
        }

        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºèª¿æ•´
        function adjustCanvasSize() {
            const container = document.querySelector('.game-container');
            const containerWidth = container.clientWidth - 40;

            if (containerWidth < 600) {
                const scale = containerWidth / 600;
                canvas.style.width = (containerWidth - 20) + 'px';
                canvas.style.height = (containerWidth - 20) + 'px';
            } else {
                canvas.style.width = '600px';
                canvas.style.height = '600px';
            }
        }

        // ã‚¿ãƒƒãƒã‚¹ã‚¿ãƒ¼ãƒˆå‡¦ç†
        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
        }

        // ã‚¿ãƒƒãƒã‚¨ãƒ³ãƒ‰å‡¦ç†ï¼ˆã‚¹ãƒ¯ã‚¤ãƒ—åˆ¤å®šï¼‰
        function handleTouchEnd(e) {
            e.preventDefault();
            if (!gameRunning || isPaused) return;

            const touch = e.changedTouches[0];
            touchEndX = touch.clientX;
            touchEndY = touch.clientY;

            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const minSwipeDistance = 30;

            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                // æ¨ªæ–¹å‘ã®ã‚¹ãƒ¯ã‚¤ãƒ—
                if (Math.abs(deltaX) > minSwipeDistance) {
                    if (deltaX > 0 && direction.x === 0) {
                        direction = { x: gridSize, y: 0 }; // å³
                    } else if (deltaX < 0 && direction.x === 0) {
                        direction = { x: -gridSize, y: 0 }; // å·¦
                    }
                }
            } else {
                // ç¸¦æ–¹å‘ã®ã‚¹ãƒ¯ã‚¤ãƒ—
                if (Math.abs(deltaY) > minSwipeDistance) {
                    if (deltaY > 0 && direction.y === 0) {
                        direction = { x: 0, y: gridSize }; // ä¸‹
                    } else if (deltaY < 0 && direction.y === 0) {
                        direction = { x: 0, y: -gridSize }; // ä¸Š
                    }
                }
            }
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            if (!gameRunning) {
                gameRunning = true;
                isPaused = false;
                direction = { x: gridSize, y: 0 }; // å³å‘ãã§ã‚¹ã‚¿ãƒ¼ãƒˆ

                // UIæ›´æ–°
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('pausePlayBtn').style.display = 'block';
                document.getElementById('gameOver').style.display = 'none';

                gameLoop = setInterval(updateGame, 100); // å°‘ã—é€Ÿãã—ãŸ
            }
        }

        // ä¸€æ™‚åœæ­¢/å†ç”Ÿåˆ‡ã‚Šæ›¿ãˆ
        function togglePause() {
            if (gameRunning) {
                if (isPaused) {
                    gameLoop = setInterval(updateGame, 100);
                    document.getElementById('pausePlayBtn').textContent = 'â¸ï¸';
                    isPaused = false;
                } else {
                    clearInterval(gameLoop);
                    document.getElementById('pausePlayBtn').textContent = 'â–¶ï¸';
                    isPaused = true;
                }
            }
        }

        // éŠã³æ–¹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
        function showHowToPlay() {
            document.getElementById('howToPlayDialog').style.display = 'flex';
        }

        // éŠã³æ–¹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°éè¡¨ç¤º
        function hideHowToPlay() {
            document.getElementById('howToPlayDialog').style.display = 'none';
        }

        // ã‚²ãƒ¼ãƒ ä¸€æ™‚åœæ­¢/å†é–‹ï¼ˆæ—§é–¢æ•°ï¼‰
        function pauseGame() {
            togglePause();
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            gameRunning = false;
            isPaused = false;
            clearInterval(gameLoop);

            snake = [{ x: 300, y: 300 }];
            direction = { x: 0, y: 0 };
            score = 0;
            bonusCount = 0;
            foods = [];

            // UIæ›´æ–°
            document.getElementById('startScreen').style.display = 'flex';
            document.getElementById('pausePlayBtn').style.display = 'none';
            document.getElementById('pausePlayBtn').textContent = 'â¸ï¸';
            document.getElementById('gameOver').style.display = 'none';

            updateScore();
            generateFood();
            drawGame();
        }

        // é£Ÿã¹ç‰©ç”Ÿæˆï¼ˆè¤‡æ•°ç¨®é¡ï¼‰
        function generateFood() {
            // é€šå¸¸ã®é£Ÿã¹ç‰©ã‚’1-3å€‹ç”Ÿæˆ
            const normalFoodCount = Math.floor(Math.random() * 3) + 1;

            for (let i = 0; i < normalFoodCount; i++) {
                let newFood;
                let attempts = 0;

                do {
                    const randomValue = Math.random() * 100;
                    let selectedType = foodTypes[0];
                    let cumulative = 0;

                    for (const type of foodTypes) {
                        cumulative += type.weight;
                        if (randomValue <= cumulative) {
                            selectedType = type;
                            break;
                        }
                    }

                    newFood = {
                        x: Math.floor(Math.random() * (canvasSize / gridSize)) * gridSize,
                        y: Math.floor(Math.random() * (canvasSize / gridSize)) * gridSize,
                        type: selectedType,
                        size: 1
                    };
                    attempts++;
                } while ((isPositionOccupied(newFood.x, newFood.y) || isPositionInFoods(newFood.x, newFood.y)) && attempts < 50);

                if (attempts < 50) {
                    foods.push(newFood);
                }
            }

            // 5%ã®ç¢ºç‡ã§ç‰¹åˆ¥ãªé£Ÿã¹ç‰©ã‚’ç”Ÿæˆ
            if (Math.random() < 0.05) {
                let specialFoodItem;
                let attempts = 0;

                do {
                    specialFoodItem = {
                        x: Math.floor(Math.random() * ((canvasSize / gridSize) - 1)) * gridSize,
                        y: Math.floor(Math.random() * ((canvasSize / gridSize) - 1)) * gridSize,
                        type: specialFood,
                        size: 2
                    };
                    attempts++;
                } while ((isSpecialPositionOccupied(specialFoodItem.x, specialFoodItem.y) || isSpecialPositionInFoods(specialFoodItem.x, specialFoodItem.y)) && attempts < 50);

                if (attempts < 50) {
                    foods.push(specialFoodItem);
                }
            }
        }

        // ä½ç½®ãŒå æœ‰ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        function isPositionOccupied(x, y) {
            return snake.some(segment => segment.x === x && segment.y === y);
        }

        function isPositionInFoods(x, y) {
            return foods.some(food => food.x === x && food.y === y);
        }

        function isSpecialPositionOccupied(x, y) {
            for (let dx = 0; dx < 2; dx++) {
                for (let dy = 0; dy < 2; dy++) {
                    if (snake.some(segment => segment.x === x + dx * gridSize && segment.y === y + dy * gridSize)) {
                        return true;
                    }
                }
            }
            return false;
        }

        function isSpecialPositionInFoods(x, y) {
            for (let dx = 0; dx < 2; dx++) {
                for (let dy = 0; dy < 2; dy++) {
                    if (foods.some(food => food.x === x + dx * gridSize && food.y === y + dy * gridSize)) {
                        return true;
                    }
                }
            }
            return false;
        }

        // ã‚²ãƒ¼ãƒ æ›´æ–°
        function updateGame() {
            if (!gameRunning || isPaused) return;

            // è›‡ã®é ­ã®æ–°ã—ã„ä½ç½®
            const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

            // å£ã¨ã®è¡çªåˆ¤å®š
            if (head.x < 0 || head.x >= canvasSize || head.y < 0 || head.y >= canvasSize) {
                gameOver();
                return;
            }

            // è‡ªåˆ†ã®ä½“ã¨ã®è¡çªåˆ¤å®š
            if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }

            snake.unshift(head);

            // é£Ÿã¹ç‰©ã‚’é£Ÿã¹ãŸã‹åˆ¤å®š
            let foodEaten = false;
            for (let i = foods.length - 1; i >= 0; i--) {
                const food = foods[i];
                let eaten = false;

                if (food.size === 1) {
                    // é€šå¸¸ã‚µã‚¤ã‚ºã®é£Ÿã¹ç‰©
                    if (head.x === food.x && head.y === food.y) {
                        eaten = true;
                    }
                } else {
                    // ç‰¹åˆ¥ãªå¤§ãã„é£Ÿã¹ç‰©ï¼ˆ2x2ï¼‰
                    for (let dx = 0; dx < 2; dx++) {
                        for (let dy = 0; dy < 2; dy++) {
                            if (head.x === food.x + dx * gridSize && head.y === food.y + dy * gridSize) {
                                eaten = true;
                                break;
                            }
                        }
                        if (eaten) break;
                    }
                }

                if (eaten) {
                    score += food.type.points;
                    if (food.type === specialFood) {
                        bonusCount++;
                    }
                    foods.splice(i, 1);
                    foodEaten = true;
                    updateScore();

                    // é£Ÿã¹ç‰©ãŒãªããªã£ãŸã‚‰æ–°ã—ãç”Ÿæˆ
                    if (foods.length === 0) {
                        generateFood();
                    }
                    break;
                }
            }

            if (!foodEaten) {
                snake.pop();
            }

            drawGame();
        }

        // ã‚²ãƒ¼ãƒ æç”»
        function drawGame() {
            // èƒŒæ™¯ã‚’ã‚¯ãƒªã‚¢
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvasSize, canvasSize);

            // ã‚°ãƒªãƒƒãƒ‰ç·šã‚’æç”»ï¼ˆè–„ãï¼‰
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= canvasSize; i += gridSize) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvasSize);
                ctx.moveTo(0, i);
                ctx.lineTo(canvasSize, i);
                ctx.stroke();
            }

            // è›‡ã‚’æç”»
            snake.forEach((segment, index) => {
                ctx.save();

                if (index === 0) {
                    // é ­éƒ¨ï¼ˆæ˜ã‚‹ã„ç·‘ã§ç«‹ä½“æ„Ÿã‚’æ¼”å‡ºï¼‰
                    const gradient = ctx.createRadialGradient(
                        segment.x + gridSize / 2, segment.y + gridSize / 2, 0,
                        segment.x + gridSize / 2, segment.y + gridSize / 2, gridSize / 2
                    );
                    gradient.addColorStop(0, '#44ff44');
                    gradient.addColorStop(1, '#00dd00');
                    ctx.fillStyle = gradient;

                    // ä¸¸ã¿ã‚’å¸¯ã³ãŸé ­éƒ¨
                    ctx.beginPath();
                    ctx.roundRect(segment.x + 1, segment.y + 1, gridSize - 2, gridSize - 2, 4);
                    ctx.fill();

                    // ç›®ã‚’æç”»
                    ctx.fillStyle = '#000';
                    ctx.beginPath();
                    ctx.arc(segment.x + 6, segment.y + 6, 2, 0, Math.PI * 2);
                    ctx.arc(segment.x + 14, segment.y + 6, 2, 0, Math.PI * 2);
                    ctx.fill();

                    // ç›®ã®ç™½ã„éƒ¨åˆ†
                    ctx.fillStyle = '#fff';
                    ctx.beginPath();
                    ctx.arc(segment.x + 7, segment.y + 5, 1, 0, Math.PI * 2);
                    ctx.arc(segment.x + 15, segment.y + 5, 1, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // ä½“éƒ¨ï¼ˆç·‘ã‹ã‚‰ç™½ã¸ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€è¦‹ã‚„ã™ã•é‡è¦–ï¼‰
                    const bodyProgress = Math.min(index / snake.length, 0.8); // æœ€å¤§80%ã¾ã§ç™½ãã™ã‚‹

                    // ç·‘ã®æˆåˆ†ã‚’ä¿ã¡ã¤ã¤ç™½ã‚’æ··ãœã‚‹
                    const greenComponent = Math.floor(200 - (bodyProgress * 80)); // 200 â†’ 120
                    const redComponent = Math.floor(bodyProgress * 180); // 0 â†’ 180
                    const blueComponent = Math.floor(bodyProgress * 180); // 0 â†’ 180

                    const gradient = ctx.createRadialGradient(
                        segment.x + gridSize / 2, segment.y + gridSize / 2, 2,
                        segment.x + gridSize / 2, segment.y + gridSize / 2, gridSize / 2
                    );
                    gradient.addColorStop(0, `rgb(${redComponent + 20}, ${greenComponent + 20}, ${blueComponent + 20})`);
                    gradient.addColorStop(1, `rgb(${redComponent}, ${greenComponent}, ${blueComponent})`);
                    ctx.fillStyle = gradient;

                    ctx.beginPath();
                    ctx.roundRect(segment.x + 2, segment.y + 2, gridSize - 4, gridSize - 4, 2);
                    ctx.fill();

                    // ä½“ã®è¼ªéƒ­ã‚’å°‘ã—å¼·èª¿
                    ctx.strokeStyle = `rgba(0, ${Math.floor(greenComponent * 0.7)}, 0, 0.8)`;
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }

                ctx.restore();
            });

            // é£Ÿã¹ç‰©ã‚’æç”»
            foods.forEach(food => {
                ctx.save();

                if (food.size === 1) {
                    // é€šå¸¸ã‚µã‚¤ã‚ºã®é£Ÿã¹ç‰©
                    drawNormalFood(food);
                } else {
                    // ç‰¹åˆ¥ãªå¤§ãã„é£Ÿã¹ç‰©
                    drawSpecialFood(food);
                }

                ctx.restore();
            });
        }

        // é€šå¸¸ã®é£Ÿã¹ç‰©æç”»
        function drawNormalFood(food) {
            const img = fruitImages[food.type.image];
            if (img && img.complete) {
                // SVGç”»åƒã‚’æç”»
                ctx.drawImage(img, food.x, food.y, gridSize, gridSize);
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šå¾“æ¥ã®æç”»æ–¹æ³•
                const centerX = food.x + gridSize / 2;
                const centerY = food.y + gridSize / 2;
                switch (food.type.emoji) {
                    case 'ğŸ':
                        drawApple(centerX, centerY, gridSize / 2 - 2);
                        break;
                    case 'ğŸŒ':
                        drawBanana(centerX, centerY, gridSize / 2 - 2);
                        break;
                    case 'ğŸ‡':
                        drawGrape(centerX, centerY, gridSize / 2 - 2);
                        break;
                    case 'ğŸ“':
                        drawStrawberry(centerX, centerY, gridSize / 2 - 2);
                        break;
                }
            }
        }

        // ç‰¹åˆ¥ãªé£Ÿã¹ç‰©æç”»ï¼ˆ2x2ãƒã‚¹ï¼‰
        function drawSpecialFood(food) {
            const img = fruitImages[food.type.image];
            if (img && img.complete) {
                // SVGç”»åƒã‚’æç”»ï¼ˆ2x2ãƒã‚¹ï¼‰
                ctx.drawImage(img, food.x, food.y, gridSize * 2, gridSize * 2);
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šå¾“æ¥ã®æç”»æ–¹æ³•
                const centerX = food.x + gridSize;
                const centerY = food.y + gridSize;

                const gradient = ctx.createRadialGradient(
                    centerX, centerY, 5,
                    centerX, centerY, gridSize
                );
                gradient.addColorStop(0, '#ffff99');
                gradient.addColorStop(0.5, '#ffd700');
                gradient.addColorStop(1, '#b8860b');
                ctx.fillStyle = gradient;

                ctx.beginPath();
                ctx.arc(centerX, centerY, gridSize - 4, 0, Math.PI * 2);
                ctx.fill();

                // æ˜Ÿã®æ¨¡æ§˜
                ctx.fillStyle = '#fff';
                ctx.font = `${gridSize}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('â˜…', centerX, centerY);

                // è¼ãã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.beginPath();
                ctx.ellipse(centerX - 5, centerY - 5, 3, 6, -Math.PI / 4, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // ã‚Šã‚“ã”æç”»
        function drawApple(x, y, radius) {
            const gradient = ctx.createRadialGradient(x, y, 2, x, y, radius);
            gradient.addColorStop(0, '#ff6666');
            gradient.addColorStop(0.7, '#ff0000');
            gradient.addColorStop(1, '#cc0000');
            ctx.fillStyle = gradient;

            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();

            // è‘‰ã£ã±
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.ellipse(x + 3, y - radius + 2, 2, 4, Math.PI / 6, 0, Math.PI * 2);
            ctx.fill();
        }

        // ãƒãƒŠãƒŠæç”»
        function drawBanana(x, y, radius) {
            ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            ctx.ellipse(x, y, radius - 2, radius, Math.PI / 4, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#ffcc00';
            ctx.beginPath();
            ctx.ellipse(x - 2, y, radius - 4, radius - 2, Math.PI / 4, 0, Math.PI * 2);
            ctx.fill();
        }

        // ã¶ã©ã†æç”»
        function drawGrape(x, y, radius) {
            const grapeColor = '#800080';
            ctx.fillStyle = grapeColor;

            // è¤‡æ•°ã®å°ã•ãªå††ã§ã¶ã©ã†ã‚’è¡¨ç¾
            const positions = [
                { dx: 0, dy: -3 },
                { dx: -3, dy: 0 },
                { dx: 3, dy: 0 },
                { dx: 0, dy: 3 }
            ];

            positions.forEach(pos => {
                ctx.beginPath();
                ctx.arc(x + pos.dx, y + pos.dy, radius / 2, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // ã„ã¡ã”æç”»
        function drawStrawberry(x, y, radius) {
            const gradient = ctx.createRadialGradient(x, y, 2, x, y, radius);
            gradient.addColorStop(0, '#ff69b4');
            gradient.addColorStop(1, '#dc143c');
            ctx.fillStyle = gradient;

            ctx.beginPath();
            ctx.ellipse(x, y + 1, radius - 1, radius, 0, 0, Math.PI * 2);
            ctx.fill();

            // è‘‰ã£ã±
            ctx.fillStyle = '#32cd32';
            ctx.beginPath();
            ctx.ellipse(x, y - radius + 2, radius / 2, 3, 0, 0, Math.PI * 2);
            ctx.fill();

            // ç¨®
            ctx.fillStyle = '#ffff00';
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.arc(x - 2 + i * 2, y + 2, 1, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // ã‚¹ã‚³ã‚¢æ›´æ–°
        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('length').textContent = snake.length;
            document.getElementById('bonusCount').textContent = bonusCount;

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ€é«˜è¨˜éŒ²æ›´æ–°
            if (score > sessionHighScore) {
                sessionHighScore = score;
                sessionHighLength = snake.length;
                sessionHighBonus = bonusCount;
                document.getElementById('sessionHigh').textContent = sessionHighScore;
                document.getElementById('sessionLength').textContent = sessionHighLength;
                document.getElementById('sessionBonus').textContent = sessionHighBonus;
            }
        }

        // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);

            // UIæ›´æ–°
            document.getElementById('startScreen').style.display = 'flex';
            document.getElementById('pausePlayBtn').style.display = 'none';
            document.getElementById('pausePlayBtn').textContent = 'â¸ï¸';

            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLength').textContent = snake.length;
            document.getElementById('finalBonus').textContent = bonusCount;
            document.getElementById('gameOver').style.display = 'block';

            // ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
                document.getElementById('highScore').textContent = highScore;
            }
        }

        // ã‚­ãƒ¼å…¥åŠ›å‡¦ç†ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢å¼·åŒ–ï¼‰
        function handleKeyPress(event) {
            // æ–¹å‘ã‚­ãƒ¼ã‚„WASDã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’å®Œå…¨ã«é˜²ã
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'w', 'W', 'a', 'A', 's', 'S', 'd', 'D'].includes(event.key)) {
                event.preventDefault();
                event.stopPropagation();
            }

            if (!gameRunning || isPaused) return;

            switch (event.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    if (direction.y === 0) direction = { x: 0, y: -gridSize };
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    if (direction.y === 0) direction = { x: 0, y: gridSize };
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    if (direction.x === 0) direction = { x: -gridSize, y: 0 };
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    if (direction.x === 0) direction = { x: gridSize, y: 0 };
                    break;
            }
        }

        // ãƒ¢ãƒã‚¤ãƒ«ç”¨æ–¹å‘å¤‰æ›´
        function changeDirection(dir) {
            if (!gameRunning || isPaused) return;

            switch (dir) {
                case 'UP':
                    if (direction.y === 0) direction = { x: 0, y: -gridSize };
                    break;
                case 'DOWN':
                    if (direction.y === 0) direction = { x: 0, y: gridSize };
                    break;
                case 'LEFT':
                    if (direction.x === 0) direction = { x: -gridSize, y: 0 };
                    break;
                case 'RIGHT':
                    if (direction.x === 0) direction = { x: gridSize, y: 0 };
                    break;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', init);

        // Canvas Rounded Rectangle polyfill for older browsers
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function (x, y, width, height, radius) {
                this.beginPath();
                this.moveTo(x + radius, y);
                this.lineTo(x + width - radius, y);
                this.quadraticCurveTo(x + width, y, x + width, y + radius);
                this.lineTo(x + width, y + height - radius);
                this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                this.lineTo(x + radius, y + height);
                this.quadraticCurveTo(x, y + height, x, y + height - radius);
                this.lineTo(x, y + radius);
                this.quadraticCurveTo(x, y, x + radius, y);
                this.closePath();
            };
        }
    </script>
</body>

</html>
