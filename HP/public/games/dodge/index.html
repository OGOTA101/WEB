<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ ã‚¹ãƒšãƒ¼ã‚¹ãƒ‰ãƒƒã‚¸ - SGGameSite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #f6f6f6;
            color: #000;
            font-size: 14px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            border-left: 1px solid #ccc;
            border-right: 1px solid #ccc;
        }

        .header {
            background: #316AC5;
            color: white;
            padding: 8px 0;
            border-bottom: 2px solid #0066cc;
        }

        .header-content {
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
        }

        .header .tagline {
            font-size: 11px;
            color: #cce0ff;
        }

        .breadcrumb {
            background: #e6f0ff;
            padding: 8px 15px;
            border-bottom: 1px solid #ccc;
            font-size: 13px;
        }

        .breadcrumb a {
            color: #0066cc;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .game-container {
            padding: 20px;
            text-align: center;
            background: linear-gradient(180deg, #000428 0%, #004e92 100%);
            color: white;
            min-height: calc(100vh - 120px);
        }

        .game-title {
            font-size: 28px;
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #00ffff;
        }

        .game-info {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .game-info h3 {
            color: #00ffff;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .controls-info {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #87ceeb;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .controls-info h4 {
            color: #87ceeb;
            margin-bottom: 10px;
        }

        .game-board {
            display: inline-block;
            background: linear-gradient(45deg, #000 0%, #1a1a2e 50%, #16213e 100%);
            border: 3px solid #00ffff;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
            touch-action: none;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            padding: 10px 20px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .stat-label {
            font-size: 12px;
            color: #87ceeb;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff;
        }

        .game-buttons {
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(45deg, #00ffff, #0080ff);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.6);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .game-over {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff0000;
            padding: 20px;
            margin: 20px auto;
            border-radius: 10px;
            max-width: 400px;
            display: none;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
        }

        .game-over h3 {
            color: #ff0000;
            font-size: 20px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #ff0000;
        }

        .high-score {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #00ff00;
            padding: 15px;
            margin: 20px auto;
            border-radius: 10px;
            max-width: 400px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }

        .high-score h4 {
            color: #00ff00;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #00ff00;
        }

        .back-link {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #00ffff;
        }

        .back-link a {
            color: #00ffff;
            text-decoration: none;
            font-size: 14px;
        }

        .back-link a:hover {
            text-decoration: underline;
            text-shadow: 0 0 5px #00ffff;
        }

        .difficulty-selector {
            margin-bottom: 20px;
        }

        .difficulty-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid #87ceeb;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .difficulty-btn.active {
            background: #00ffff;
            color: #000;
            box-shadow: 0 0 10px #00ffff;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }

            .game-stats {
                gap: 15px;
                flex-direction: column;
                align-items: center;
            }

            .game-board {
                max-width: 100%;
                border-width: 2px;
            }

            #gameCanvas {
                max-width: 100%;
                height: auto;
            }

            .game-title {
                font-size: 24px;
            }
        }

        @media (max-width: 480px) {
            .btn {
                margin: 5px;
                padding: 10px 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <div class="header-content">
                <h1>ğŸ® SGGameSite</h1>
                <div class="tagline">Yahoo! Gamesé¢¨ãƒ¬ãƒˆãƒ­ã‚²ãƒ¼ãƒ ã‚µã‚¤ãƒˆ</div>
            </div>
        </div>

        <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ -->
        <div class="breadcrumb">
            <a href="../../index.html">ãƒ›ãƒ¼ãƒ </a> > <a href="../../index.html#games">ã‚²ãƒ¼ãƒ </a> > ã‚¹ãƒšãƒ¼ã‚¹ãƒ‰ãƒƒã‚¸
        </div>

        <!-- ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="game-container">
            <div class="game-title">ğŸš€ ã‚¹ãƒšãƒ¼ã‚¹ãƒ‰ãƒƒã‚¸</div>

            <div class="game-info">
                <h3>ğŸŒŒ ãƒŸãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦</h3>
                <p>å®‡å®™èˆ¹ã‚’æ“ç¸¦ã—ã¦ã€éš•çŸ³ã¨æ•µæ©Ÿã®æ”»æ’ƒã‚’é¿ã‘ç¶šã‘ã‚ˆã†ï¼</p>
                <p>ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¢ã‚’10å€‹é›†ã‚ã¦æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰ç™ºå‹•ï¼éšœå®³ç‰©ã‚’ç ´å£Šã—ã¦ã‚¹ã‚³ã‚¢ã‚¢ãƒƒãƒ—ï¼</p>
            </div>

            <div class="controls-info">
                <h4>ğŸ•¹ï¸ æ“ä½œæ–¹æ³•</h4>
                <p><strong>PC:</strong> ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯ãƒ»ãƒ‰ãƒ©ãƒƒã‚°ã§ç·‘ã®ï¼‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¨­å®š</p>
                <p><strong>ã‚¹ãƒãƒ›:</strong> ã‚¿ãƒƒãƒ—ãƒ»ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨­å®šï¼ˆæŒ‡ã®å°‘ã—ä¸Šã«è¡¨ç¤ºï¼‰</p>
                <p><strong>ç§»å‹•:</strong> å®‡å®™èˆ¹ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«å‘ã‹ã£ã¦ç§»å‹•ã€‚è·é›¢ã«å¿œã˜ã¦æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™</p>
            </div>

            <!-- é›£æ˜“åº¦é¸æŠ -->
            <div class="difficulty-selector">
                <h4>ğŸ¯ é›£æ˜“åº¦é¸æŠ</h4>
                <button class="difficulty-btn active" onclick="setDifficulty('easy')">åˆç´š</button>
                <button class="difficulty-btn" onclick="setDifficulty('normal')">ä¸­ç´š</button>
                <button class="difficulty-btn" onclick="setDifficulty('hard')">ä¸Šç´š</button>
                <button class="difficulty-btn" onclick="setDifficulty('extreme')">æ¥µé™</button>
            </div>

            <!-- ãƒ‡ãƒãƒƒã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
            <div class="difficulty-selector">
                <h4>ğŸ”§ ãƒ‡ãƒãƒƒã‚°</h4>
                <button class="difficulty-btn" onclick="toggleHitboxes()">å½“ãŸã‚Šåˆ¤å®šè¡¨ç¤º: <span
                        id="hitboxStatus">OFF</span></button>
            </div>

            <!-- ã‚²ãƒ¼ãƒ çµ±è¨ˆ -->
            <div class="game-stats">
                <div class="stat-item">
                    <div class="stat-label">ã‚¹ã‚³ã‚¢</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ç”Ÿå­˜æ™‚é–“</div>
                    <div class="stat-value" id="survivalTime">0.0s</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æœ€é«˜ã‚¹ã‚³ã‚¢</div>
                    <div class="stat-value" id="highScore">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ã‚¨ãƒãƒ«ã‚®ãƒ¼</div>
                    <div class="stat-value" id="energyCount">0</div>
                </div>
            </div>

            <!-- ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
            <div class="game-buttons">
                <button class="btn" id="startBtn" onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
                <button class="btn" id="pauseBtn" onclick="pauseGame()" disabled>ä¸€æ™‚åœæ­¢</button>
                <button class="btn" id="resetBtn" onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>

            <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
            <div class="game-board">
                <div class="stars" id="stars"></div>
                <canvas id="gameCanvas" width="600" height="600"></canvas>
            </div>

            <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼è¡¨ç¤º -->
            <div class="game-over" id="gameOver">
                <h3>ğŸ’¥ ãƒŸãƒƒã‚·ãƒ§ãƒ³å¤±æ•—ï¼</h3>
                <p>æœ€çµ‚ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span></p>
                <p>ç”Ÿå­˜æ™‚é–“: <span id="finalTime">0.0</span>ç§’</p>
                <p>ã‚¨ãƒãƒ«ã‚®ãƒ¼ç²å¾—: <span id="finalEnergy">0</span>å€‹</p>
                <button class="btn" onclick="resetGame()" style="margin-top: 15px;">å†ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
            </div>

            <!-- ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
            <div class="high-score">
                <h4>ğŸ† ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ€é«˜è¨˜éŒ²</h4>
                <p>ã‚¹ã‚³ã‚¢: <span id="sessionHigh">0</span> | æ™‚é–“: <span id="sessionTime">0.0</span>ç§’ | ã‚¨ãƒãƒ«ã‚®ãƒ¼: <span
                        id="sessionEnergy">0</span>å€‹</p>
            </div>

            <!-- æˆ»ã‚‹ãƒªãƒ³ã‚¯ -->
            <div class="back-link">
                <a href="../../index.html">â† ã‚²ãƒ¼ãƒ ä¸€è¦§ã«æˆ»ã‚‹</a>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ å¤‰æ•°
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const canvasWidth = 600;
        const canvasHeight = 600;

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
        let player = {
            x: canvasWidth / 2 - 20, // ä¸­å¤®ã«é…ç½®ï¼ˆwidth/2ã‚’å¼•ãï¼‰
            y: canvasHeight - 80,
            width: 40,
            height: 40,
            speed: 300, // ãƒ”ã‚¯ã‚»ãƒ«/ç§’
            // å½“ãŸã‚Šåˆ¤å®šç”¨ï¼ˆç‚¹ãƒ¬ãƒ™ãƒ«ã¾ã§å°ã•ãï¼‰
            hitboxWidth: 4,
            hitboxHeight: 4,
            hitboxOffsetX: 18, // ä¸­å¤®ã«é…ç½®
            hitboxOffsetY: 18,
            // ç§»å‹•ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
            targetX: canvasWidth / 2 - 20,
            targetY: canvasHeight - 80,
            isMoving: false,
            // æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰
            attackMode: false,
            attackGauge: 0,
            maxAttackGauge: 300 // 5ç§’é–“ã®æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰ï¼ˆ60fps Ã— 5ç§’ï¼‰
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameRunning = false;
        let gameLoop = null;
        let isPaused = false;
        let score = 0;
        let energyCount = 0;
        let startTime = 0;
        let currentTime = 0;

        // éšœå®³ç‰©ã¨ã‚¢ã‚¤ãƒ†ãƒ 
        let obstacles = [];
        let powerups = [];
        let particles = [];
        let stars = [];

        // é›£æ˜“åº¦è¨­å®š
        let difficulty = 'easy';
        const difficultySettings = {
            easy: { spawnRate: 0.02, speed: 2, maxObstacles: 8 },
            normal: { spawnRate: 0.03, speed: 3, maxObstacles: 12 },
            hard: { spawnRate: 0.04, speed: 4, maxObstacles: 16 },
            extreme: { spawnRate: 0.06, speed: 5, maxObstacles: 20 }
        };

        // ç”»åƒãƒªã‚½ãƒ¼ã‚¹
        const gameImages = {};
        let imagesLoaded = 0;
        const totalImages = 4;

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
        let highScore = localStorage.getItem('dodgeHighScore') || 0;
        let sessionHighScore = 0;
        let sessionHighTime = 0;
        let sessionHighEnergy = 0;

        // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼ˆå½“ãŸã‚Šåˆ¤å®šè¡¨ç¤ºï¼‰
        let showHitboxes = false;

        // æ™‚é–“ç®¡ç†ç”¨
        let lastUpdateTime = 0;

        // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¡¨ç¤ºç”¨
        let target = {
            x: 0,
            y: 0,
            visible: false,
            lastUpdate: 0
        };

        // æ˜Ÿç©ºèƒŒæ™¯ç”Ÿæˆ
        function generateStars() {
            stars = [];
            for (let i = 0; i < 100; i++) {
                stars.push({
                    x: Math.random() * canvasWidth,
                    y: Math.random() * canvasHeight,
                    size: Math.random() * 2 + 0.5,
                    speed: Math.random() * 0.5 + 0.2,
                    brightness: Math.random() * 0.8 + 0.2
                });
            }
        }

        // ç”»åƒèª­ã¿è¾¼ã¿
        function loadImages() {
            const imageNames = ['spaceship', 'asteroid', 'enemy', 'powerup'];

            imageNames.forEach(name => {
                const img = new Image();
                img.onload = () => {
                    imagesLoaded++;
                    if (imagesLoaded === totalImages) {
                        document.getElementById('startBtn').disabled = false;
                        document.getElementById('startBtn').textContent = 'ã‚²ãƒ¼ãƒ é–‹å§‹';
                    }
                };
                img.onerror = () => {
                    console.warn(`Failed to load image: ${name}.svg`);
                    imagesLoaded++;
                    if (imagesLoaded === totalImages) {
                        document.getElementById('startBtn').disabled = false;
                        document.getElementById('startBtn').textContent = 'ã‚²ãƒ¼ãƒ é–‹å§‹';
                    }
                };
                img.src = `assets/images/${name}.svg`;
                gameImages[name] = img;
            });
        }

        // åˆæœŸåŒ–
        function init() {
            document.getElementById('highScore').textContent = highScore;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('startBtn').textContent = 'ç”»åƒèª­ã¿è¾¼ã¿ä¸­...';

            loadImages();
            generateStars();
            setupEventListeners();
            drawGame();
        }

        // ãƒã‚¦ã‚¹çŠ¶æ…‹ç®¡ç†
        let isMouseDown = false;

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            // ãƒã‚¦ã‚¹æ“ä½œ
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('click', handleMouseClick);
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mouseup', handleMouseUp);

            // ã‚¿ãƒƒãƒæ“ä½œ
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });

            // ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
            window.addEventListener('resize', adjustCanvasSize);
            adjustCanvasSize();
        }

        // ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function handleMouseClick(e) {
            if (!gameRunning || isPaused) return;

            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const mouseX = (e.clientX - rect.left) * scaleX;
            const mouseY = (e.clientY - rect.top) * scaleY;

            setPlayerTarget(mouseX, mouseY);
        }

        // ãƒã‚¦ã‚¹ç§»å‹•å‡¦ç†
        function handleMouseMove(e) {
            if (!gameRunning || isPaused || !isMouseDown) return;

            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const mouseX = (e.clientX - rect.left) * scaleX;
            const mouseY = (e.clientY - rect.top) * scaleY;

            setPlayerTarget(mouseX, mouseY);
        }

        // ãƒã‚¦ã‚¹ãƒ€ã‚¦ãƒ³å‡¦ç†
        function handleMouseDown(e) {
            if (!gameRunning || isPaused) return;
            isMouseDown = true;
            handleMouseClick(e);
        }

        // ãƒã‚¦ã‚¹ã‚¢ãƒƒãƒ—å‡¦ç†
        function handleMouseUp(e) {
            isMouseDown = false;
        }

        // ã‚¿ãƒƒãƒç§»å‹•å‡¦ç†
        function handleTouchMove(e) {
            e.preventDefault();
            if (!gameRunning || isPaused) return;

            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const touchX = (touch.clientX - rect.left) * scaleX;
            const touchY = (touch.clientY - rect.top) * scaleY;

            // ã‚¿ãƒƒãƒä½ç½®ã®å°‘ã—ä¸Šã«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¨­å®šï¼ˆæŒ‡ã§éš ã‚Œã‚‹ã®ã‚’é˜²ãï¼‰
            setPlayerTarget(touchX, touchY - 60);
        }

        // ã‚¿ãƒƒãƒé–‹å§‹å‡¦ç†
        function handleTouchStart(e) {
            e.preventDefault();
            handleTouchMove(e);
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨­å®š
        function setPlayerTarget(x, y) {
            // ç”»é¢å†…ã«åˆ¶é™ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸­å¿ƒåŸºæº–ï¼‰
            const targetX = Math.max(player.width / 2, Math.min(canvasWidth - player.width / 2, x));
            const targetY = Math.max(player.height / 2, Math.min(canvasHeight - player.height / 2, y));

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å·¦ä¸Šåº§æ¨™ã«å¤‰æ›
            player.targetX = targetX - player.width / 2;
            player.targetY = targetY - player.height / 2;
            player.isMoving = true;

            // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¡¨ç¤ºç”¨
            target.x = targetX;
            target.y = targetY;
            target.visible = true;
            target.lastUpdate = Date.now();
        }

        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºèª¿æ•´
        function adjustCanvasSize() {
            const container = document.querySelector('.game-container');
            const containerWidth = container.clientWidth - 40;

            if (containerWidth < 600) {
                canvas.style.width = (containerWidth - 20) + 'px';
                canvas.style.height = (containerWidth - 20) + 'px';
            } else {
                canvas.style.width = '600px';
                canvas.style.height = '600px';
            }
        }

        // é›£æ˜“åº¦è¨­å®š
        function setDifficulty(level) {
            difficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // å½“ãŸã‚Šåˆ¤å®šè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleHitboxes() {
            showHitboxes = !showHitboxes;
            document.getElementById('hitboxStatus').textContent = showHitboxes ? 'ON' : 'OFF';
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            if (!gameRunning) {
                gameRunning = true;
                isPaused = false;
                startTime = Date.now();

                // ãƒªã‚»ãƒƒãƒˆ
                obstacles = [];
                powerups = [];
                particles = [];
                score = 0;
                energyCount = 0;
                player.x = canvasWidth / 2 - player.width / 2;
                player.y = canvasHeight - 80;
                player.targetX = player.x;
                player.targetY = player.y;
                player.isMoving = false;
                player.attackMode = false;
                player.attackGauge = 0;
                target.visible = false;
                lastUpdateTime = 0;

                document.getElementById('startBtn').disabled = true;
                document.getElementById('pauseBtn').disabled = false;
                document.getElementById('gameOver').style.display = 'none';

                gameLoop = setInterval(updateGame, 16); // 60 FPS
            }
        }

        // ã‚²ãƒ¼ãƒ ä¸€æ™‚åœæ­¢/å†é–‹
        function pauseGame() {
            if (gameRunning) {
                if (isPaused) {
                    gameLoop = setInterval(updateGame, 16);
                    document.getElementById('pauseBtn').textContent = 'ä¸€æ™‚åœæ­¢';
                    isPaused = false;
                } else {
                    clearInterval(gameLoop);
                    document.getElementById('pauseBtn').textContent = 'å†é–‹';
                    isPaused = true;
                }
            }
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            gameRunning = false;
            isPaused = false;
            clearInterval(gameLoop);

            obstacles = [];
            powerups = [];
            particles = [];
            score = 0;
            energyCount = 0;
            player.x = canvasWidth / 2 - player.width / 2;
            player.y = canvasHeight - 80;
            player.targetX = player.x;
            player.targetY = player.y;
            player.isMoving = false;
            player.attackMode = false;
            player.attackGauge = 0;
            target.visible = false;
            lastUpdateTime = 0;

            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('pauseBtn').textContent = 'ä¸€æ™‚åœæ­¢';
            document.getElementById('gameOver').style.display = 'none';

            updateStats();
            drawGame();
        }

        // éšœå®³ç‰©ç”Ÿæˆ
        function spawnObstacle() {
            const settings = difficultySettings[difficulty];
            if (obstacles.length >= settings.maxObstacles) return;

            const type = Math.random() < 0.7 ? 'asteroid' : 'enemy';
            const size = type === 'asteroid' ? 30 : 35;

            // å½“ãŸã‚Šåˆ¤å®šã¯ç”»åƒã‚ˆã‚Šå°ã•ãè¨­å®š
            const hitboxSize = type === 'asteroid' ? 20 : 24;
            const hitboxOffset = (size - hitboxSize) / 2;

            obstacles.push({
                x: Math.random() * (canvasWidth - size),
                y: -size,
                width: size,
                height: size,
                speed: settings.speed + Math.random() * 2,
                type: type,
                rotation: 0,
                rotationSpeed: (Math.random() - 0.5) * 0.2,
                // å½“ãŸã‚Šåˆ¤å®šç”¨
                hitboxWidth: hitboxSize,
                hitboxHeight: hitboxSize,
                hitboxOffsetX: hitboxOffset,
                hitboxOffsetY: hitboxOffset
            });
        }

        // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ç”Ÿæˆ
        function spawnPowerup() {
            if (Math.random() < 0.005) { // 0.5%ã®ç¢ºç‡
                const size = 25;
                const hitboxSize = 18; // ç”»åƒã‚ˆã‚Šå°ã•ã
                const hitboxOffset = (size - hitboxSize) / 2;

                powerups.push({
                    x: Math.random() * (canvasWidth - size),
                    y: -size,
                    width: size,
                    height: size,
                    speed: 2,
                    pulse: 0,
                    // å½“ãŸã‚Šåˆ¤å®šç”¨
                    hitboxWidth: hitboxSize,
                    hitboxHeight: hitboxSize,
                    hitboxOffsetX: hitboxOffset,
                    hitboxOffsetY: hitboxOffset
                });
            }
        }

        // è¡çªåˆ¤å®šï¼ˆæ”¹è‰¯ç‰ˆï¼šhitboxä½¿ç”¨ï¼‰
        function checkCollision(obj1, obj2) {
            // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ1ã®å½“ãŸã‚Šåˆ¤å®šç¯„å›²ã‚’è¨ˆç®—
            const obj1HitX = obj1.x + (obj1.hitboxOffsetX || 0);
            const obj1HitY = obj1.y + (obj1.hitboxOffsetY || 0);
            const obj1HitWidth = obj1.hitboxWidth || obj1.width;
            const obj1HitHeight = obj1.hitboxHeight || obj1.height;

            // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ2ã®å½“ãŸã‚Šåˆ¤å®šç¯„å›²ã‚’è¨ˆç®—
            const obj2HitX = obj2.x + (obj2.hitboxOffsetX || 0);
            const obj2HitY = obj2.y + (obj2.hitboxOffsetY || 0);
            const obj2HitWidth = obj2.hitboxWidth || obj2.width;
            const obj2HitHeight = obj2.hitboxHeight || obj2.height;

            // å½“ãŸã‚Šåˆ¤å®š
            return obj1HitX < obj2HitX + obj2HitWidth &&
                obj1HitX + obj1HitWidth > obj2HitX &&
                obj1HitY < obj2HitY + obj2HitHeight &&
                obj1HitY + obj1HitHeight > obj2HitY;
        }

        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆ
        function createParticles(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    decay: 0.02,
                    color: color,
                    size: Math.random() * 4 + 2
                });
            }
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•æ›´æ–°
        function updatePlayerMovement(deltaTime) {
            if (!player.isMoving) return;

            const dx = player.targetX - player.x;
            const dy = player.targetY - player.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 2) {
                // ç›®æ¨™ã«åˆ°é”
                player.x = player.targetX;
                player.y = player.targetY;
                player.isMoving = false;
                target.visible = false;
            } else {
                // ç›®æ¨™ã«å‘ã‹ã£ã¦ç§»å‹•
                const moveDistance = player.speed * deltaTime;
                const ratio = Math.min(moveDistance / distance, 1);

                player.x += dx * ratio;
                player.y += dy * ratio;
            }
        }

        // æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰æ›´æ–°
        function updateAttackMode() {
            if (!player.attackMode) return;

            player.attackGauge--;
            if (player.attackGauge <= 0) {
                player.attackMode = false;
                player.attackGauge = 0;
            }
        }

        // ã‚²ãƒ¼ãƒ æ›´æ–°
        function updateGame() {
            if (!gameRunning || isPaused) return;

            const now = Date.now();
            const deltaTime = (now - (lastUpdateTime || now)) / 1000;
            lastUpdateTime = now;

            currentTime = (now - startTime) / 1000;

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•æ›´æ–°
            updatePlayerMovement(deltaTime);

            // æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰æ›´æ–°
            updateAttackMode();

            // éšœå®³ç‰©ã¨ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã®ç”Ÿæˆ
            const settings = difficultySettings[difficulty];
            if (Math.random() < settings.spawnRate) {
                spawnObstacle();
            }
            spawnPowerup();

            // éšœå®³ç‰©ã®æ›´æ–°
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                obstacle.y += obstacle.speed;
                obstacle.rotation += obstacle.rotationSpeed;

                // ç”»é¢å¤–ã«å‡ºãŸã‚‰å‰Šé™¤
                if (obstacle.y > canvasHeight) {
                    obstacles.splice(i, 1);
                    score += 10; // å›é¿ãƒœãƒ¼ãƒŠã‚¹
                    continue;
                }

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã®è¡çªåˆ¤å®š
                if (checkCollision(player, obstacle)) {
                    if (player.attackMode) {
                        // æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰æ™‚ï¼šéšœå®³ç‰©ã‚’ç ´å£Š
                        createParticles(obstacle.x + obstacle.width / 2, obstacle.y + obstacle.height / 2, '#ff6600', 20);
                        obstacles.splice(i, 1);
                        score += obstacle.type === 'asteroid' ? 50 : 75; // éš•çŸ³50ç‚¹ã€æ•µæ©Ÿ75ç‚¹
                    } else {
                        // é€šå¸¸æ™‚ï¼šã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
                        createParticles(player.x + player.width / 2, player.y + player.height / 2, '#ff0000', 20);
                        gameOver();
                        return;
                    }
                }
            }

            // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã®æ›´æ–°
            for (let i = powerups.length - 1; i >= 0; i--) {
                const powerup = powerups[i];
                powerup.y += powerup.speed;
                powerup.pulse += 0.2;

                // ç”»é¢å¤–ã«å‡ºãŸã‚‰å‰Šé™¤
                if (powerup.y > canvasHeight) {
                    powerups.splice(i, 1);
                    continue;
                }

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã®è¡çªåˆ¤å®š
                if (checkCollision(player, powerup)) {
                    createParticles(powerup.x + powerup.width / 2, powerup.y + powerup.height / 2, '#00ffff', 15);
                    powerups.splice(i, 1);
                    energyCount++;
                    score += 100;

                    // ã‚¨ãƒãƒ«ã‚®ãƒ¼10å€‹ã§æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰ç™ºå‹•
                    if (energyCount >= 10 && !player.attackMode) {
                        energyCount -= 10;
                        player.attackMode = true;
                        player.attackGauge = player.maxAttackGauge;
                        createParticles(player.x + player.width / 2, player.y + player.height / 2, '#ff0000', 25);
                    }
                }
            }

            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®æ›´æ–°
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life -= particle.decay;

                if (particle.life <= 0) {
                    particles.splice(i, 1);
                }
            }

            // æ˜Ÿã®æ›´æ–°
            stars.forEach(star => {
                star.y += star.speed;
                if (star.y > canvasHeight) {
                    star.y = -5;
                    star.x = Math.random() * canvasWidth;
                }
            });

            // æ™‚é–“ãƒœãƒ¼ãƒŠã‚¹
            score += Math.floor(currentTime / 10);

            // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè‡ªå‹•éè¡¨ç¤ºï¼ˆ3ç§’å¾Œï¼‰
            if (target.visible && (now - target.lastUpdate) > 3000) {
                target.visible = false;
            }

            updateStats();
            drawGame();
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('survivalTime').textContent = currentTime.toFixed(1) + 's';
            document.getElementById('energyCount').textContent = energyCount;

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ€é«˜è¨˜éŒ²æ›´æ–°
            if (score > sessionHighScore) {
                sessionHighScore = score;
                sessionHighTime = currentTime;
                sessionHighEnergy = energyCount;
                document.getElementById('sessionHigh').textContent = sessionHighScore;
                document.getElementById('sessionTime').textContent = sessionHighTime.toFixed(1);
                document.getElementById('sessionEnergy').textContent = sessionHighEnergy;
            }
        }

        // ã‚²ãƒ¼ãƒ æç”»
        function drawGame() {
            // èƒŒæ™¯ã‚¯ãƒªã‚¢ï¼ˆå®‡å®™ç©ºé–“ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);
            gradient.addColorStop(0, '#000428');
            gradient.addColorStop(0.5, '#1a1a2e');
            gradient.addColorStop(1, '#16213e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);

            // æ˜Ÿç©ºæç”»
            stars.forEach(star => {
                ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æç”»
            ctx.save();

            // æ”»æ’ƒãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚ªãƒ¼ãƒ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            if (player.attackMode) {
                const auraSize = player.width + 20 + Math.sin(Date.now() / 100) * 5;
                const gradient = ctx.createRadialGradient(
                    player.x + player.width / 2, player.y + player.height / 2, 0,
                    player.x + player.width / 2, player.y + player.height / 2, auraSize / 2
                );
                gradient.addColorStop(0, 'rgba(255, 100, 0, 0.3)');
                gradient.addColorStop(0.7, 'rgba(255, 0, 0, 0.2)');
                gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(player.x + player.width / 2, player.y + player.height / 2, auraSize / 2, 0, Math.PI * 2);
                ctx.fill();
            }

            const playerImg = gameImages['spaceship'];
            if (playerImg && playerImg.complete) {
                ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æç”»ï¼ˆä¸‰è§’å½¢ã®å®‡å®™èˆ¹ï¼‰
                ctx.fillStyle = player.attackMode ? '#ff4500' : '#4a90e2';
                ctx.beginPath();
                ctx.moveTo(player.x + player.width / 2, player.y);
                ctx.lineTo(player.x, player.y + player.height);
                ctx.lineTo(player.x + player.width, player.y + player.height);
                ctx.closePath();
                ctx.fill();
            }

            ctx.restore();

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å½“ãŸã‚Šåˆ¤å®šè¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
            if (showHitboxes) {
                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = 2;
                ctx.strokeRect(
                    player.x + player.hitboxOffsetX,
                    player.y + player.hitboxOffsetY,
                    player.hitboxWidth,
                    player.hitboxHeight
                );
            }

            // éšœå®³ç‰©æç”»
            obstacles.forEach(obstacle => {
                ctx.save();
                ctx.translate(obstacle.x + obstacle.width / 2, obstacle.y + obstacle.height / 2);
                ctx.rotate(obstacle.rotation);

                const img = gameImages[obstacle.type];
                if (img && img.complete) {
                    ctx.drawImage(img, -obstacle.width / 2, -obstacle.height / 2, obstacle.width, obstacle.height);
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æç”»
                    ctx.fillStyle = obstacle.type === 'asteroid' ? '#8b4513' : '#dc143c';
                    ctx.beginPath();
                    ctx.arc(0, 0, obstacle.width / 2, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.restore();

                // éšœå®³ç‰©ã®å½“ãŸã‚Šåˆ¤å®šè¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
                if (showHitboxes) {
                    ctx.strokeStyle = '#ff0000';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(
                        obstacle.x + obstacle.hitboxOffsetX,
                        obstacle.y + obstacle.hitboxOffsetY,
                        obstacle.hitboxWidth,
                        obstacle.hitboxHeight
                    );
                }
            });

            // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—æç”»
            powerups.forEach(powerup => {
                ctx.save();
                ctx.translate(powerup.x + powerup.width / 2, powerup.y + powerup.height / 2);

                const pulseFactor = 1 + Math.sin(powerup.pulse) * 0.2;
                ctx.scale(pulseFactor, pulseFactor);

                const img = gameImages['powerup'];
                if (img && img.complete) {
                    ctx.drawImage(img, -powerup.width / 2, -powerup.height / 2, powerup.width, powerup.height);
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æç”»ï¼ˆè¼ãã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚³ã‚¢ï¼‰
                    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, powerup.width / 2);
                    gradient.addColorStop(0, '#00ffff');
                    gradient.addColorStop(0.7, '#0080ff');
                    gradient.addColorStop(1, '#004080');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(0, 0, powerup.width / 2, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.restore();

                // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã®å½“ãŸã‚Šåˆ¤å®šè¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
                if (showHitboxes) {
                    ctx.strokeStyle = '#00ffff';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(
                        powerup.x + powerup.hitboxOffsetX,
                        powerup.y + powerup.hitboxOffsetY,
                        powerup.hitboxWidth,
                        powerup.hitboxHeight
                    );
                }
            });

            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æç”»
            particles.forEach(particle => {
                ctx.save();
                ctx.globalAlpha = particle.life;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            });

            // æ”»æ’ƒã‚²ãƒ¼ã‚¸æç”»
            if (player.attackMode) {
                const gaugeX = player.x + player.width / 2 - 30;
                const gaugeY = player.y - 15;
                const gaugeWidth = 60;
                const gaugeHeight = 6;
                const progress = player.attackGauge / player.maxAttackGauge;

                // ã‚²ãƒ¼ã‚¸èƒŒæ™¯
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(gaugeX - 1, gaugeY - 1, gaugeWidth + 2, gaugeHeight + 2);

                // ã‚²ãƒ¼ã‚¸æœ¬ä½“
                ctx.fillStyle = progress > 0.3 ? '#ff4500' : '#ff0000';
                ctx.fillRect(gaugeX, gaugeY, gaugeWidth * progress, gaugeHeight);

                // ã‚²ãƒ¼ã‚¸æ 
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 1;
                ctx.strokeRect(gaugeX, gaugeY, gaugeWidth, gaugeHeight);

                // ã€ŒATTACKã€ãƒ†ã‚­ã‚¹ãƒˆ
                ctx.fillStyle = '#ffffff';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ATTACK', player.x + player.width / 2, gaugeY - 3);
            }

            // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆï¼‹ï¼‰æç”»
            if (target.visible) {
                const crossSize = 12;
                const crossThickness = 2;

                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = crossThickness;
                ctx.lineCap = 'round';

                // ç¸¦ç·š
                ctx.beginPath();
                ctx.moveTo(target.x, target.y - crossSize);
                ctx.lineTo(target.x, target.y + crossSize);
                ctx.stroke();

                // æ¨ªç·š
                ctx.beginPath();
                ctx.moveTo(target.x - crossSize, target.y);
                ctx.lineTo(target.x + crossSize, target.y);
                ctx.stroke();

                // ä¸­å¤®ã®ç‚¹
                ctx.fillStyle = '#00ff00';
                ctx.beginPath();
                ctx.arc(target.x, target.y, 2, 0, Math.PI * 2);
                ctx.fill();
            }

            // ä¸€æ™‚åœæ­¢è¡¨ç¤º
            if (isPaused) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                ctx.fillStyle = '#00ffff';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('PAUSED', canvasWidth / 2, canvasHeight / 2);
                ctx.textAlign = 'left';
            }
        }

        // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);

            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('pauseBtn').textContent = 'ä¸€æ™‚åœæ­¢';

            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalTime').textContent = currentTime.toFixed(1);
            document.getElementById('finalEnergy').textContent = energyCount;
            document.getElementById('gameOver').style.display = 'block';

            // ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('dodgeHighScore', highScore);
                document.getElementById('highScore').textContent = highScore;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', init);
    </script>
</body>

</html>
