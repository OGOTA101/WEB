<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ナンバーリンクは2-20人で遊べるオンライン協力型数字推理ゲームです。">
    <title>ナンバーリンク - オンライン協力ゲーム</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>

<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="header">
            <div class="header-content">
                <div>
                    <h1><a href="../../index.html" style="color: inherit; text-decoration: none;">🎮 SGGameSite</a></h1>
                    <p class="tagline">Yahoo! Games風レトロゲームサイト</p>
                </div>
            </div>
        </header>
        
        <!-- ゲームタイトル -->
        <div style="text-align: center; padding: 20px 0; background: #f0f0f0; border-bottom: 2px solid #ccc;">
            <h2 style="margin: 0; color: #316AC5;">🔢 ナンバーリンク</h2>
            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">協力型数字推理ゲーム</p>
        </div>

        <!-- スタート画面 -->
        <div id="startScreen" class="screen active">
            <div class="welcome-box">
                <h2>🎮 ようこそ！</h2>
                <p>2-20人で遊べる協力型数字推理ゲーム</p>
                <div class="name-input-section">
                    <label for="playerNameInput">プレイヤー名を入力:</label>
                    <input type="text" id="playerNameInput" maxlength="15" placeholder="なまえ" />
                </div>
                <div class="button-group">
                    <button class="primary-btn" onclick="showCreateRoom()">ルームを作成</button>
                    <button class="secondary-btn" onclick="showJoinRoom()">ルームに参加</button>
                </div>
                <div class="rules-link">
                    <button class="text-btn" onclick="showRules()">📖 ルール説明</button>
                </div>
            </div>
        </div>

        <!-- ルール説明モーダル -->
        <div id="rulesModal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeRules()">&times;</span>
                <h2>📖 ゲームルール</h2>
                <div class="rules-content">
                    <h3>🎯 目的</h3>
                    <p>全員で協力して、カードを小さい順に出すことを目指します。</p>
                    
                    <h3>🎲 基本ルール</h3>
                    <ol>
                        <li>各プレイヤーに1-100の数字カードが配られる</li>
                        <li>テーマが提示される（例：「好きな食べ物」）</li>
                        <li>自分のカードをテーマに例えて説明する（数字は見せない）</li>
                        <li>全員で相談して、小さい順にカードを出す</li>
                        <li>順番が正しければ成功、間違えたらライフが減る</li>
                    </ol>
                    
                    <h3>📊 レベル制</h3>
                    <ul>
                        <li><strong>レベル1:</strong> ライフ3 - ウォームアップ</li>
                        <li><strong>レベル2:</strong> ライフ2 - 本番</li>
                        <li><strong>レベル3:</strong> ライフ1 - 最終試練</li>
                    </ul>
                    
                    <h3>💡 コツ</h3>
                    <p>具体的に説明しすぎず、かといって抽象的すぎないバランスが大事！</p>
                </div>
            </div>
        </div>

        <!-- ルーム作成画面 -->
        <div id="createRoomScreen" class="screen">
            <div class="room-box">
                <h2>🏠 ルームを作成</h2>
                <div class="room-info" style="background: #e3f2fd; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <p style="font-size: 14px; color: #666;">ルームを作成すると、6桁のルームコードが発行されます。<br>友達にコードを共有して、一緒に遊びましょう！</p>
                </div>
                <div class="player-count-section">
                    <label for="maxPlayers">最大人数:</label>
                    <select id="maxPlayers">
                        <option value="2">2人</option>
                        <option value="3">3人</option>
                        <option value="4" selected>4人</option>
                        <option value="5">5人</option>
                        <option value="6">6人</option>
                        <option value="8">8人</option>
                        <option value="10">10人</option>
                        <option value="15">15人</option>
                        <option value="20">20人</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="primary-btn" onclick="createRoom()">ルーム作成</button>
                    <button class="secondary-btn" onclick="backToStart()">戻る</button>
                </div>
            </div>
        </div>

        <!-- ルーム参加画面 -->
        <div id="joinRoomScreen" class="screen">
            <div class="room-box">
                <h2>🚪 ルームに参加</h2>
                <div class="code-input-section">
                    <label for="roomCodeInput">ルームコード（6桁）:</label>
                    <input type="text" id="roomCodeInput" maxlength="6" placeholder="123456" />
                </div>
                <div class="button-group">
                    <button class="primary-btn" onclick="joinRoom()">参加</button>
                    <button class="secondary-btn" onclick="backToStart()">戻る</button>
                </div>
            </div>
        </div>

        <!-- 待機画面 -->
        <div id="lobbyScreen" class="screen">
            <div class="lobby-box">
                <h2>🏠 ルーム待機中</h2>
                <div class="room-info" style="margin-bottom: 20px;">
                    <p style="font-size: 14px; margin-bottom: 10px;">ルームコード（友達に共有してね）</p>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span id="lobbyRoomCode" class="room-code"></span>
                        <button class="copy-btn" onclick="copyLobbyRoomCode()">📋 コピー</button>
                    </div>
                </div>
                <div class="lobby-info">
                    <p>プレイヤー: <span id="currentPlayerCount">0</span> / <span id="maxPlayerCount">0</span></p>
                </div>
                <div class="players-list" id="playersList">
                    <!-- プレイヤーリストが動的に追加される -->
                </div>
                <div class="button-group">
                    <button class="primary-btn" id="startGameBtn" onclick="startGame()" disabled>ゲーム開始</button>
                    <button class="danger-btn" onclick="leaveRoom()">退出</button>
                </div>
            </div>
        </div>

        <!-- ゲーム画面 -->
        <div id="gameScreen" class="screen">
            <!-- ゲーム情報バー -->
            <div class="game-info-bar">
                <div class="level-info">
                    <span>レベル: <strong id="currentLevel">1</strong></span>
                </div>
                <div class="life-info">
                    <span id="lifeDisplay">❤️❤️❤️</span>
                </div>
                <div class="turn-info">
                    <span>ターン: <span id="currentTurn">1</span> / <span id="totalTurns">0</span></span>
                </div>
            </div>

            <!-- テーマ表示エリア -->
            <div class="theme-area" id="themeArea">
                <div class="theme-selector" id="themeSelector">
                    <h3>🎨 テーマを選んでください</h3>
                    <p class="theme-turn-info">あなたの番です！</p>
                    <div class="theme-buttons">
                        <button class="theme-btn" onclick="showThemeList()">プリセットから選ぶ</button>
                        <button class="theme-btn" onclick="showCustomTheme()">自分で決める</button>
                    </div>
                </div>
                <div class="theme-display" id="themeDisplay">
                    <h3>今回のテーマ</h3>
                    <p class="theme-text" id="currentTheme">---</p>
                    <p class="theme-selected-by">選んだ人: <span id="themeSelector Name">---</span></p>
                </div>
            </div>

            <!-- プレイエリア -->
            <div class="play-area">
                <!-- 他のプレイヤーの状態 -->
                <div class="other-players-area">
                    <h3>他のプレイヤー</h3>
                    <div class="other-players-list" id="otherPlayersList">
                        <!-- プレイヤーが動的に追加される -->
                    </div>
                </div>

                <!-- プレイされたカード -->
                <div class="played-cards-area">
                    <h3>場に出たカード</h3>
                    <div class="played-cards" id="playedCards">
                        <!-- カードが動的に追加される -->
                    </div>
                </div>

                <!-- 自分のカード -->
                <div class="my-card-area">
                    <h3>あなたの手札</h3>
                    <div class="my-cards-container" id="myCardsContainer">
                        <!-- カードが動的に追加される -->
                    </div>
                    <div class="card-actions">
                        <input type="text" id="cardDescription" placeholder="説明（任意）" maxlength="100" />
                        <button class="action-btn" id="submitDescriptionBtn" onclick="submitDescription()">説明送信</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- リザルト画面 -->
        <div id="resultScreen" class="screen">
            <div class="result-box" id="resultBox">
                <!-- ゲームオーバー -->
                <div class="game-over" id="gameOverResult">
                    <h2 class="result-title fail">💔 ゲームオーバー</h2>
                    <p class="result-message">残念！もう一度挑戦しよう</p>
                    <div class="result-stats">
                        <p>到達レベル: <span id="reachedLevel">1</span></p>
                    </div>
                </div>
                <!-- ゲームクリア -->
                <div class="game-clear" id="gameClearResult">
                    <h2 class="result-title success">🎉 ゲームクリア！</h2>
                    <p class="result-message">おめでとうございます！</p>
                    <div class="result-stats">
                        <p>全レベルクリア！</p>
                    </div>
                </div>
                <div class="button-group">
                    <button class="primary-btn" onclick="backToLobby()">ロビーに戻る</button>
                    <button class="secondary-btn" onclick="backToStart()">タイトルへ</button>
                </div>
            </div>
        </div>

        <!-- ゲームログ（右下固定） -->
        <div class="game-log" id="gameLog">
            <div class="log-header">
                <span>📜 ログ</span>
                <button class="log-toggle" onclick="toggleLog()">_</button>
            </div>
            <div class="log-content" id="logContent">
                <!-- ログが動的に追加される -->
            </div>
        </div>

        <!-- テーマ選択モーダル -->
        <div id="themeListModal" class="modal">
            <div class="modal-content theme-modal">
                <span class="close-btn" onclick="closeThemeList()">&times;</span>
                <h2>🎨 テーマを選択</h2>
                <div class="theme-list" id="themeList">
                    <!-- テーマボタンが動的に追加される -->
                </div>
            </div>
        </div>

        <!-- カスタムテーマ入力モーダル -->
        <div id="customThemeModal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeCustomTheme()">&times;</span>
                <h2>✏️ 自分でテーマを決める</h2>
                <div class="custom-theme-input">
                    <input type="text" id="customThemeInput" placeholder="テーマを入力（例: 好きな食べ物）" maxlength="30" />
                    <button class="primary-btn" onclick="setCustomTheme()">決定</button>
                </div>
            </div>
        </div>

        <!-- 判定演出オーバーレイ -->
        <div id="judgeOverlay" class="judge-overlay">
            <div class="judge-content">
                <div class="judge-icon" id="judgeIcon">🤔</div>
                <h2 id="judgeTitle">判定中...</h2>
                <p id="judgeMessage">カードを確認しています</p>
            </div>
        </div>

        <!-- ローディング表示 -->
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p>通信中...</p>
        </div>

        <!-- フッター -->
        <footer style="background: #f0f0f0; padding: 15px; border-top: 1px solid #ccc; font-size: 12px; color: #666; text-align: center;">
            &copy; 2024 SGGameSite - Yahoo! Games風レトロゲームサイト | 軽量・高速・シンプル
        </footer>
    </div>

    <!-- ゲームスクリプト -->
    <script src="game-script.js"></script>
</body>

</html>

