# 仕様書: 星空さんぽ (仮) / Starry Cat - 開発バイブル

## 1. コンセプト・世界観
**「眠れない夜は、星を集めて。」**
ふんわりとしたパステル調の夜空と、シルエットで描かれる猫。
プレイヤーは猫となり、夜空を見上げて落ちてくる星屑や輝く星々を集める。
静かで優しいピアノやオルゴールのBGM。

## 2. 画面レイアウト・UI構成 (Asset ID: UI_xxx)

### 共通レイアウト (比率 9:16)
- **Viewport**: 常に 9:16 を維持。PC等では左右に黒帯 (`#000000`) を表示。
- **Background (BG_Main)**:
  - **Layer 1 (奥)**: 静的な夜空（濃紺〜紫のグラデーション）。
  - **Layer 2 (中)**: ゆっくり流れる雲（半透明）。
  - **Layer 3 (前)**: 輝く星々（動的なパーティクル）。
- **Cat Area (Character)**:
  - 画面下部中央（Y: 80%〜90%付近）に猫を配置。
  - 後ろ姿、または見上げているポーズ。

### インゲームUI (GameUI)
「没入感」を最優先し、数値表示を極限まで減らす。
- **スタミナ表示 (StaminaFX)**:
  - バーや数値は表示しない。
  - **通常**: 猫の周囲がほんのり温かい光で包まれている。
  - **減少時**: 光が弱まり、範囲が狭くなる。
  - **危険域**: 画面周辺にうっすらと暗いビネット(Vignette)がかかる。猫がうつむく。
- **スコア表示 (ScoreFX)**:
  - 常駐表示なし。
  - 星獲得時のみ、猫の頭上に `+1` や `+Bonus` の文字が浮き上がり、フェードアウトする。
- **ポーズボタン (Btn_Pause)**:
  - 画面右上または左上に、非常に薄い（透明度30%程度）一時停止アイコン。

## 3. ゲームモード詳細

### A. 星をあつめる (Normal Mode)
- **概要**: スコアアタックメインモード。
- **開始**: メニュー画面で「右」に回転してスタート。
- **ルール**:
  - 星をタップして獲得。
  - **空振り（星が無い場所をタップ）**: スタミナ減少（ダメージ）。
  - **見逃し（星が消滅）**: ペナルティなし。ただしコンボは途切れる。
- **終了条件 (Game Over)**:
  1. **スタミナ枯渇**: 空振りを繰り返してスタミナが0になる。
     - 演出: 猫が丸まって眠ってしまう。「おやすみなさい」の文字。
  2. **プレイヤー中断**: ポーズメニューから終了。
- **報酬**: 獲得した星の数 × 1.0倍。

### B. ずっとあつめる (Endless Mode)
- **概要**: 練習・リラックス用モード。
- **開始**: メニュー画面で「下」に回転してスタート。
- **ルール**:
  - スタミナは減らない（空振りしてもエフェクトのみ）。
  - ゲームオーバーが存在しない。
- **終了条件**:
  - **プレイヤー中断のみ**: ポーズメニュー → 「おわる」を選択。
- **報酬**: 獲得した星の数 × 0.1倍（端数切り捨て）。

## 4. メニュー遷移と回転演出 (Scene Flow)

ホームを原点(0,0)とし、仮想的な十字配置の空間をカメラが移動・回転する。

1.  **ホーム (Home)** `[Center]`
    - 猫が座ってこっちを見ている、または空を見上げている。
    - タップで「にゃーん」と鳴く。
2.  **通常ゲーム (Game)** `[Right]`
    - カメラが右へパンし、広い夜空を見上げる構図へ。
    - 中央に「Start」代わりの大きな一番星。
3.  **装備/おめかし (Equip)** `[Left]`
    - カメラが左へパンし、鏡やクローゼットがある部屋（または空間）へ。
    - アイテムリストがふわっと浮き出る。
4.  **ガチャ (Gacha)** `[Up]`
    - カメラが真上を向く。
    - 満天の星空。「星を捧げる」ボタンが出現。
5.  **エンドレス (Endless)** `[Down]`
    - カメラが下へパンし、少し遠景の丘を見下ろすような構図。
    - 落ち着いた雰囲気。
6.  **クレジット (Credit)** `[Right -> Right]`
    - 通常ゲーム画面からさらに右、または特定操作で表示。
    - 星座線でスタッフ名が描かれる。

## 5. 難易度レベルデザイン (Level Design)

コンボ数 (Combo) に連動して、以下のパラメータがリアルタイムに変動する。
**基本パラメータ**:
- `SpawnRate`: 星が出る頻度 (秒)
- `LifeTime`: 星が表示されている時間 (秒)
- `Type`: 星の種類 (静止/移動/点滅)

| Lv | コンボ数 | 状態名 | 出現間隔 | 表示時間 | 挙動詳細 |
|:--:|:---:|:---|:---:|:---:|:---|
| **0** | 0-9 | **Intro** | 3.0s | 3.0s | 完全静止。巨大。チュートリアル用。 |
| **1-5** | 10-29 | **Slow** | 2.5s | 2.5s | 静止。ゆっくり。 |
| **6-10** | 30-59 | **Normal** | 2.0s | 2.0s | 静止。標準的なリズム。 |
| **11-15** | 60-89 | **Fast** | 1.8s | 1.5s | 静止。ここから少し忙しくなる。 |
| **16-20** | 90-119 | **Wobbly** | 1.5s | 1.2s | **微動**。出現後に位置がゆらゆら揺れる。 |
| **21-25** | 120-149 | **Moving** | 1.2s | 1.0s | **移動**。画面を横切るようにゆっくり動く。 |
| **26-28** | 150-179 | **Rush** | 0.8s | 0.8s | 移動＋短時間。反射神経が必要。 |
| **29** | 180-199 | **Blink** | 1.0s | 0.7s | **点滅**。消えたり現れたりするフェイント。 |
| **30** | 200~ | **Starfall** | 0.5s | 0.6s | **流星群**。複数個が同時に、あるいは乱数で連続出現。 |

## 6. データ定義：アイテム・アクセサリー (Item Data)

JSON形式で管理するアイテムリスト。`ID`で管理。

### Category: Head (頭)
| ID | 名前 | 効果 (Buff) | 説明 |
|:--:|:---|:---|:---|
| `h01` | **星のかけらピン** | なし (初期) | 小さな星が光るヘアピン。 |
| `h02` | **ナイトキャップ** | スタミナ減少 -20% | ふわふわで良い夢が見られそう。 |
| `h03` | **三日月の冠** | 表示時間 +0.2秒 | 月の魔力で時を少し止める。 |
| `h04` | **宇宙メット** | コンボボーナス +1 | 宇宙飛行士気分。 |
| `h05` | **ねこみみ** | フィーバー率 x1.5 | 猫に猫耳。あざとい。 |

### Category: Neck (首)
| ID | 名前 | 効果 (Buff) | 説明 |
|:--:|:---|:---|:---|
| `n01` | **赤いリボン** | なし (初期) | お母さんにもらったリボン。 |
| `n02` | **鈴の首輪** | SE変化 (チリン) | 歩くと可愛い音がする。 |
| `n03` | **銀河ストール** | 獲得星数 +10% | 星屑を織り込んだストール。 |
| `n04` | **天使の羽** | 自動回復 (微) | 背中に小さな羽が生える。 |
| `n05` | **あったかマフラー** | ミス判定縮小 | 判定が少し甘くなる。 |

### Category: Aura (エフェクト)
| ID | 名前 | 効果 (Buff) | 説明 |
|:--:|:---|:---|:---|
| `a01` | **なし** | - | - |
| `a02` | **光の足跡** | なし (演出のみ) | 歩いた場所に光が残る。 |
| `a03` | **ホタル** | なし (演出のみ) | 周囲を光の玉が舞う。 |
| `a04` | **虹オーラ** | 全ステータス +5% | 全身がうっすら虹色に。 |

## 7. 必要なアセットリスト (Assets)

### 画像 (Images) - `assets/images/`
- `cat_base.png`: 猫の基本シルエット
- `cat_parts.png`: 部位分け（アニメーション用：しっぽ、耳、手）
- `star_normal.png`: 通常の星
- `star_rare.png`: レア星
- `star_particle.png`: キラキラエフェクト用
- `bg_gradient.png`: 背景グラデーション
- `bg_clouds.png`: 雲（シームレス）
- `icon_pause.png`: 一時停止アイコン
- `item_icons.png`: 装備アイテムのアイコンスプライト
- `ui_arrow.png`: メニュー移動用の矢印ガイド

### 音声 (Audio) - `assets/audio/`
- `bgm_main.mp3`: 静かなピアノバラード（ループ）
- `se_tap_star.mp3`: キラッ（高音のベル）
- `se_tap_empty.mp3`: スカッ（低い気の抜けた音）
- `se_cat_voice.mp3`: 「にゃ～」（ランダムピッチで使用）
- `se_menu_woosh.mp3`: シュッ（画面回転時の風切り音）
- `se_gacha.mp3`: キラキラキラ…ポン！（ガチャ演出音）
- `se_result.mp3`: ジャン！（リザルト表示）

## 8. 開発環境・クラス設計 (Tech Spec)
- **Engine**: Pure JavaScript (No Frameworks required for this scale) + Canvas API
- **Class Structure**:
  - `GameManager`: 状態管理 (State Machine: Home, Game, Pause, Result)
  - `InputManager`: タッチ・マウスクリックの正規化処理
  - `ResourceManager`: 画像・音声のプリロード管理
  - `StarEntity`: 星のインスタンス。位置、寿命、描画更新を持つ。
  - `CatEntity`: 猫の描画、装備反映、アニメーション管理。
  - `MenuDirector`: 画面遷移（回転演出）の座標計算とDOM制御。
  - `StorageManager`: `localStorage` へのセーブ/ロード。


