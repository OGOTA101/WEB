# 🐱 ネズミ狩りの夜 - 仕様書

## 1. 概要

### 1.1 ゲームコンセプト
猫を操作してネズミの大群から主人のチーズを守る、ワンマップ防衛ゲーム。
ゲームボーイ風のレトロドット絵で描かれた可愛らしい世界観と、シンプルながら奥深いスキルツリーシステムが特徴。

### 1.2 ゲームの特徴
- **ワンマップ防衛**: 1つの固定マップで戦い続ける
- **昼夜サイクル**: 「ネズミ狩りの夜が始まる」→「昼（休憩/強化）」を繰り返す
- **タップ to ムーブ**: スマホでも遊びやすい直感的操作
- **協力プレイ対応**: 複数の猫で一緒に防衛
- **スキルツリー**: 猫をカスタマイズして強化

### 1.3 プラットフォーム
| 項目 | 詳細 |
|------|------|
| 対応ブラウザ | Chrome, Firefox, Edge, Safari |
| 対応デバイス | PC、スマートフォン、タブレット |
| 通信 | Firebase Realtime Database（協力プレイ時） |
| ホスティング | Firebase Hosting |

---

## 2. 世界観・ストーリー

### 2.1 設定
あなたは主人に飼われている勇敢な猫。
夜になると、主人が大切にしているチーズを狙ってネズミの大群が押し寄せてくる。
チーズを守り抜くため、夜通し戦い続けるのが猫の使命！

### 2.2 ゲームサイクル
```
┌─────────────────────────────────────────┐
│         🌙 ネズミ狩りの夜が始まる        │
│                                         │
│   ネズミが画面上部から出現              │
│   制限時間内に全ネズミを倒す            │
│   チーズのHPを守り切る                  │
│                                         │
└────────────────┬────────────────────────┘
                 ↓ (クリア または 時間切れ)
┌─────────────────────────────────────────┐
│              ☀️ 昼（休憩フェーズ）        │
│                                         │
│   経験値獲得・レベルアップ               │
│   スキルツリーで強化                     │
│   チーズのHP回復（少量）                 │
│   次の夜に備える                        │
│                                         │
└────────────────┬────────────────────────┘
                 ↓
          次のウェーブへ（最大30レベル）
```

---

## 3. ゲームシステム

### 3.1 マップ構成

```
┌─────────────────────────────────────────┐
│ ← ← ← ← ← ネズミ出現エリア → → → → → │
│  🐭   🐭   🐭   🐭   🐭   🐭   🐭   🐭  │
├─────────────────────────────────────────┤
│                                         │
│                                         │
│           プレイエリア                   │
│                                         │
│               🐱 ← 猫                   │
│                                         │
│                                         │
├─────────────────────────────────────────┤
│            🧀🧀🧀🧀🧀                    │
│            ← 主人のチーズ →              │
└─────────────────────────────────────────┘
```

| 要素 | 説明 |
|------|------|
| ネズミ出現エリア | 画面最上部。ネズミはここからランダムに出現 |
| プレイエリア | 猫が自由に動ける範囲（マップ外には出られない） |
| チーズエリア | 画面最下部。ネズミに到達されるとダメージ |

### 3.2 チーズ（守護対象）

| パラメータ | 値 |
|-----------|-----|
| 初期HP | 100 |
| ネズミ1匹の攻撃ダメージ | 5〜20（種類による） |
| 昼の回復量 | 10 HP |
| ゲームオーバー条件 | HP が 0 になる |

### 3.3 レベル（ウェーブ）システム

| レベル | ネズミ数 | 特徴 |
|--------|---------|------|
| 1-5 | 5〜15匹 | 通常ネズミのみ。チュートリアル的 |
| 6-10 | 15〜30匹 | 速いネズミ登場 |
| 11-15 | 30〜50匹 | 大きいネズミ登場 |
| 16-20 | 50〜80匹 | ボスネズミ登場 |
| 21-25 | 80〜120匹 | 全種類混合、高密度 |
| 26-30 | 120〜200匹 | 超高難度、ネズミの嵐 |

---

## 4. キャラクター

### 4.1 猫（プレイヤー）

#### 基本ステータス
| パラメータ | 初期値 | 説明 |
|-----------|-------|------|
| 移動速度 | 非常に速い（8） | ネズミより圧倒的に速い |
| 攻撃力 | 10 | 近接攻撃のダメージ |
| 攻撃速度 | 1.0秒/回 | 攻撃の間隔 |
| 攻撃範囲 | 近接（1マス） | 周囲のネズミを攻撃 |
| HP | なし | 猫は無敵（チーズを守るのが目的） |

#### 操作方法
| 操作 | 説明 |
|------|------|
| タップ / クリック | その位置に猫が高速移動 |
| 移動中 | 攻撃不可（移動に専念） |
| 停止中 | 自動で範囲内の敵を攻撃 |

### 4.2 ネズミ（敵）

#### ネズミの種類
| 種類 | 絵 | HP | 移動速度 | 攻撃力 | 特徴 |
|------|-----|-----|---------|-------|------|
| 通常ネズミ | 🐭 | 10 | 遅い（2） | 5 | 基本の敵 |
| 速いネズミ | 🐀 | 8 | 速い（4） | 3 | 素早いが脆い |
| 大きいネズミ | 🐹 | 30 | とても遅い（1） | 10 | 硬くて攻撃力高い |
| ボスネズミ | 👑🐭 | 100 | 遅い（1.5） | 20 | 各区切りで出現 |
| 群れネズミ | 🐭🐭🐭 | 5 | 遅い（2） | 2 | 大量に出現 |

#### ネズミの行動パターン
1. 画面上部からランダム位置に出現
2. まっすぐ下（チーズ方向）へ移動
3. チーズに到達するとダメージを与える
4. ダメージを与えた後、消滅

---

## 5. スキルツリーシステム

### 5.1 概要
昼フェーズで「スキルポイント（SP）」を消費して猫を強化。
3つのスキルブランチから自由に選択できる。

### 5.2 スキルポイント獲得
| 条件 | 獲得SP |
|------|--------|
| レベルクリア | 3 SP |
| ネズミ撃破（10匹ごと） | 1 SP |
| ボス撃破 | 5 SP |
| ノーダメージクリア | 2 SP ボーナス |

### 5.3 スキルブランチ

```
                    🐱 猫のスキルツリー
                          │
          ┌───────────────┼───────────────┐
          ▼               ▼               ▼
    ⚔️ 攻撃系         🛡️ 防衛系         ✨ 特殊系
```

#### ⚔️ 攻撃ブランチ（Attack）
| スキル名 | 必要SP | 効果 | 前提スキル |
|---------|-------|------|-----------|
| 爪研ぎ Lv1 | 2 | 攻撃力 +5 | なし |
| 爪研ぎ Lv2 | 3 | 攻撃力 +10 | 爪研ぎ Lv1 |
| 爪研ぎ Lv3 | 5 | 攻撃力 +15 | 爪研ぎ Lv2 |
| 連続攻撃 | 4 | 攻撃速度 20%上昇 | 爪研ぎ Lv1 |
| 範囲拡大 | 5 | 攻撃範囲 1.5倍 | 連続攻撃 |
| 貫通爪 | 6 | 攻撃が敵を貫通（2体同時攻撃） | 範囲拡大 |
| 猫パンチ | 8 | クリティカル率 10% | 爪研ぎ Lv3 |
| 必殺爪 | 10 | クリティカル率 25% & ダメージ2倍 | 猫パンチ |

#### 🛡️ 防衛ブランチ（Defense）
| スキル名 | 必要SP | 効果 | 前提スキル |
|---------|-------|------|-----------|
| チーズガード Lv1 | 2 | チーズHP +20 | なし |
| チーズガード Lv2 | 3 | チーズHP +40 | チーズガード Lv1 |
| チーズガード Lv3 | 5 | チーズHP +60 | チーズガード Lv2 |
| 回復の陽光 | 4 | 昼の回復量 +10 | チーズガード Lv1 |
| 鉄壁チーズ | 6 | ネズミのダメージ 20%軽減 | 回復の陽光 |
| 威嚇オーラ | 5 | 猫の周囲でネズミが減速 | チーズガード Lv2 |
| ネズミ返し | 8 | チーズ到達時に確率でネズミ弾き返し | 鉄壁チーズ |
| 絶対防衛 | 10 | 1ウェーブに1回、ダメージ無効化 | ネズミ返し |

#### ✨ 特殊ブランチ（Special）
| スキル名 | 必要SP | 効果 | 前提スキル |
|---------|-------|------|-----------|
| 俊足 Lv1 | 2 | 移動速度 +10% | なし |
| 俊足 Lv2 | 3 | 移動速度 +20% | 俊足 Lv1 |
| 俊足 Lv3 | 5 | 移動速度 +30% | 俊足 Lv2 |
| 移動攻撃 | 6 | 移動中も攻撃可能（威力50%） | 俊足 Lv2 |
| 瞬間移動 | 8 | タップした場所に瞬時に移動（CD:10秒） | 移動攻撃 |
| 経験値アップ | 4 | 獲得SP +50% | なし |
| ラッキーキャット | 5 | ボーナスドロップ確率上昇 | 経験値アップ |
| 九つの命 | 10 | チーズHP0で1回だけ50%回復 | ラッキーキャット |

### 5.4 スキルツリーUI

```
┌─────────────────────────────────────────────┐
│  ☀️ 昼フェーズ - スキル強化              SP: 12 │
├─────────────────────────────────────────────┤
│                                             │
│  ⚔️ 攻撃    🛡️ 防衛    ✨ 特殊            │
│  ────────  ────────  ────────             │
│  [爪研ぎ1] [ﾁｰｽﾞｶﾞｰﾄﾞ] [俊足 Lv1]          │
│     ↓         ↓         ↓                 │
│  [爪研ぎ2] [回復の陽光] [俊足 Lv2]          │
│     ↓↘        ↓         ↓                 │
│  [連続攻撃]  [鉄壁]    [移動攻撃]          │
│     ↓                   ↓                 │
│  [範囲拡大]           [瞬間移動]           │
│                                             │
├─────────────────────────────────────────────┤
│  [次の夜へ進む]    [スキルリセット 5SP]      │
└─────────────────────────────────────────────┘
```

---

## 6. 協力プレイシステム

### 6.1 参加方法
- ルームコードを共有して最大4人まで参加可能
- 各プレイヤーは異なる色の猫を操作

### 6.2 協力プレイのルール
| 項目 | 詳細 |
|------|------|
| 猫の数 | プレイヤー数と同じ（1〜4匹） |
| チーズ | 共有（全員で守る） |
| ネズミ数 | プレイヤー数に応じて増加（×1.5） |
| スキルツリー | 各プレイヤー個別に管理 |
| SP | 各プレイヤー個別に獲得 |

### 6.3 同期データ
| データ | 同期タイミング |
|--------|---------------|
| 猫の位置 | リアルタイム |
| ネズミの位置 | ホストから配信 |
| チーズHP | 状態変化時 |
| スキル発動 | 発動時 |

---

## 7. グラフィック・アート

### 7.1 スタイル
- **解像度**: ゲームボーイ風（160×144 相当をスケーリング）
- **色数**: 4色パレット風（緑系/グレー系）
- **ピクセルサイズ**: 8×8 または 16×16 ドット

### 7.2 必要なスプライト
| 素材 | サイズ | 説明 |
|------|--------|------|
| 猫 | 16×16 | 4方向 × 2フレーム（待機/移動） |
| 猫（攻撃） | 16×16 | 攻撃モーション（2フレーム） |
| 通常ネズミ | 8×8 | 2フレームアニメ |
| 速いネズミ | 8×8 | 2フレームアニメ |
| 大きいネズミ | 16×16 | 2フレームアニメ |
| ボスネズミ | 24×24 | 4フレームアニメ |
| チーズ | 32×16 | 5段階（HP表示） |
| 背景（床） | 8×8 タイル | 繰り返し可能 |
| 夜空 | 160×32 | 星が瞬くアニメ |
| 昼空 | 160×32 | 雲が流れる |

### 7.3 カラーパレット

#### ゲームボーイ風（夜）
| 名前 | 色コード | 用途 |
|------|---------|------|
| 暗い緑 | #0f380f | 背景、影 |
| 中暗緑 | #306230 | アウトライン |
| 中明緑 | #8bac0f | メイン色 |
| 明るい緑 | #9bbc0f | ハイライト |

#### ゲームボーイ風（昼）
| 名前 | 色コード | 用途 |
|------|---------|------|
| ダークグレー | #1a1a2e | 影 |
| ミッドグレー | #4a4e69 | アウトライン |
| ライトグレー | #9a8c98 | メイン色 |
| ホワイト | #f2e9e4 | ハイライト |

---

## 8. サウンド設計

### 8.1 BGM
| 場面 | 説明 |
|------|------|
| 夜（戦闘） | 緊張感のあるチップチューン（8bit風） |
| 昼（休憩） | 穏やかなチップチューン |
| ボス戦 | 激しいチップチューン |
| ゲームオーバー | 悲しいメロディ |
| クリア | 勝利のファンファーレ |

### 8.2 効果音
| アクション | 説明 |
|-----------|------|
| 猫の移動 | サッという素早い音 |
| 猫の攻撃 | シュッ（爪)＋パシッ（ヒット） |
| ネズミ撃破 | ポンッ（消滅音） |
| チーズダメージ | ガブッ（噛む音） |
| レベルアップ | キラーン |
| スキル習得 | ジャーン |

---

## 9. UI/UX設計

### 9.1 ゲーム画面レイアウト

```
┌─────────────────────────────────────────────┐
│ Wave 15/30  🧀HP: ████████░░ 80%  SP: 12    │ ← ヘッダー
├─────────────────────────────────────────────┤
│                                             │
│     🐭   🐭       🐭   🐀   🐭              │
│                                             │
│           🐭   🐹       🐭                  │
│                                             │
│                   🐱                        │ ← ゲームエリア
│                                             │
│             🐭         🐭                   │
│                                             │
├─────────────────────────────────────────────┤
│            🧀🧀🧀🧀🧀🧀🧀🧀                   │
└─────────────────────────────────────────────┘
```

### 9.2 昼フェーズUI

```
┌─────────────────────────────────────────────┐
│              ☀️ 昼 - 休憩中                  │
├─────────────────────────────────────────────┤
│                                             │
│   Wave 15 クリア！                          │
│   撃破数: 45匹  獲得SP: 8                   │
│                                             │
│   チーズHP回復: +10                          │
│   現在HP: 90/100                            │
│                                             │
├─────────────────────────────────────────────┤
│   [スキル強化]      [次の夜へ]               │
└─────────────────────────────────────────────┘
```

---

## 10. ファイル構成

```
cat-defense/
├── index.html              # エントリーポイント
├── style.css               # グローバルスタイル
├── package.json            # 依存関係
├── firebase.json           # Firebaseホスティング設定
├── .firebaserc             # Firebaseプロジェクト設定
├── SPECIFICATION.md        # 本仕様書
│
├── src/
│   ├── main.js             # アプリケーションエントリー
│   ├── game/
│   │   ├── Game.js         # メインゲームクラス
│   │   ├── Cat.js          # 猫キャラクター
│   │   ├── Mouse.js        # ネズミクラス
│   │   ├── Cheese.js       # チーズ（守護対象）
│   │   ├── Wave.js         # ウェーブ管理
│   │   └── GameState.js    # 状態管理（夜/昼）
│   │
│   ├── skills/
│   │   ├── SkillTree.js    # スキルツリー管理
│   │   ├── AttackSkills.js # 攻撃スキル定義
│   │   ├── DefenseSkills.js# 防衛スキル定義
│   │   └── SpecialSkills.js# 特殊スキル定義
│   │
│   ├── multiplayer/
│   │   ├── Firebase.js     # Firebase接続
│   │   ├── Room.js         # ルーム管理
│   │   └── Sync.js         # 同期処理
│   │
│   ├── ui/
│   │   ├── HUD.js          # ヘッドアップディスプレイ
│   │   ├── SkillTreeUI.js  # スキル選択画面
│   │   ├── TitleScreen.js  # タイトル画面
│   │   └── ResultScreen.js # リザルト画面
│   │
│   └── assets/
│       ├── sprites/        # ドット絵スプライト
│       │   ├── cat.png
│       │   ├── mouse.png
│       │   ├── cheese.png
│       │   └── tiles.png
│       ├── audio/          # 効果音・BGM
│       └── fonts/          # ピクセルフォント
│
└── public/
    └── (静的ファイル)
```

---

## 11. Firebase データ構造

```json
{
  "rooms": {
    "<roomId>": {
      "state": "night",
      "wave": 15,
      "cheese": {
        "hp": 80,
        "maxHp": 100
      },
      "players": {
        "<playerId>": {
          "name": "たま",
          "color": "#FF6B6B",
          "position": { "x": 100, "y": 200 },
          "isMoving": false,
          "sp": 12,
          "skills": ["claw_lv1", "claw_lv2", "speed_lv1"]
        }
      },
      "mice": {
        "<mouseId>": {
          "type": "normal",
          "position": { "x": 50, "y": 30 },
          "hp": 10
        }
      }
    }
  }
}
```

---

## 12. 開発ロードマップ

### Phase 1: 基盤構築
- [x] 仕様書作成
- [ ] プロジェクトセットアップ
- [ ] Canvas/WebGL描画環境
- [ ] ドット絵レンダリング

### Phase 2: 猫とネズミ
- [ ] 猫の移動システム（タップ移動）
- [ ] 猫の自動攻撃
- [ ] ネズミの生成と移動
- [ ] 当たり判定

### Phase 3: ゲームフロー
- [ ] ウェーブシステム
- [ ] 昼夜サイクル
- [ ] チーズHP管理
- [ ] ゲームオーバー/クリア判定

### Phase 4: スキルツリー
- [ ] SP獲得システム
- [ ] スキルツリーUI
- [ ] 各スキル効果の実装

### Phase 5: マルチプレイヤー
- [ ] Firebase連携
- [ ] ルーム作成/参加
- [ ] プレイヤー同期

### Phase 6: 仕上げ
- [ ] ドット絵素材作成
- [ ] BGM/効果音
- [ ] UI/UXポリッシュ
- [ ] デプロイ

---

## 13. 将来的な拡張案

- **猫の種類**: 異なる能力を持つ複数の猫キャラクター
- **ステージ選択**: 複数のマップ（季節の変化など）
- **イベント**: 期間限定ボスやスペシャルウェーブ
- **実績システム**: 条件達成でアンロック
- **デイリーチャレンジ**: 毎日異なる条件でプレイ

---

## 14. SGGameSite への追加

### 追加場所
- **カテゴリ**: 協力・パーティーゲーム
- **URL**: `games/cat-defense/`

### ゲーム一覧表示
| 項目 | 内容 |
|------|------|
| ゲーム名 | 🐱 ネズミ狩りの夜 |
| 説明 | 猫を操作してネズミからチーズを守る防衛ゲーム。スマホ対応、最大4人協力プレイ可能！ |
| 人数 | 1-4人 |
| 状態 | NEW! |

---

*最終更新: 2026-01-26*
*バージョン: 1.0.0*
